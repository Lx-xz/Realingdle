(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97936,e=>{"use strict";var s=e.i(43476);function a({children:e,onClick:a,type:r="button",variant:c="primary",disabled:t=!1}){return(0,s.jsx)("button",{className:`button button--${c}`,onClick:a,type:r,disabled:t,children:e})}e.s(["default",()=>a])},1892,e=>{"use strict";var s=e.i(17927);let a=`
  id,
  name,
  description,
  image_url,
  age,
  created_at,
  updated_at,
  state:states(id, name),
  classes:character_classes(class:classes(id, name)),
  races:character_races(race:races(id, name)),
  occupations:character_occupations(occupation:occupations(id, name)),
  associations:character_associations(association:associations(id, name)),
  places:character_places(place:places(id, name))
`,r=e=>({id:e.id,name:e.name,description:e.description,image_url:e.image_url,age:e.age,created_at:e.created_at,updated_at:e.updated_at,state:Array.isArray(e.state)?e.state[0]:e.state,classes:e.classes?.map(e=>e.class)??[],races:e.races?.map(e=>e.race)??[],occupations:e.occupations?.map(e=>e.occupation)??[],associations:e.associations?.map(e=>e.association)??[],places:e.places?.map(e=>e.place)??[]}),c=async(e={})=>{let{data:c,error:t}=await s.supabase.from("characters").select(a).order("name",{ascending:e.ascending??!0});if(t)throw t;return c.map(r)};e.s(["fetchCharacters",0,c])},8134,e=>{"use strict";var s=e.i(43476),a=e.i(71645),r=e.i(18566),c=e.i(4048);function t({value:e,onChange:r,onSubmit:t,suggestions:i=[],onSelectSuggestion:l,noResultsText:n="No results",placeholder:d="Search character...",disabled:o=!1}){let m=(0,a.useRef)(null),[u,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=e=>{m.current&&(m.current.contains(e.target)||h(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let _=u&&e.trim().length>0,g=i.length>0;return(0,s.jsx)("form",{className:"search-bar",onSubmit:s=>{s.preventDefault(),e.trim()&&(t(e.trim()),h(!1))},children:(0,s.jsxs)("div",{className:"search-bar__field",ref:m,children:[(0,s.jsx)("input",{type:"text",className:"search-bar__input",value:e,onChange:e=>{r(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:d,disabled:o}),_&&(0,s.jsx)("div",{className:"search-bar__dropdown",children:g?(0,s.jsx)(c.default,{className:"search-bar__scroll",maxHeight:220,children:(0,s.jsx)("ul",{className:"search-bar__list",children:i.map(e=>(0,s.jsx)("li",{className:"search-bar__item",children:(0,s.jsxs)("button",{type:"button",onClick:()=>{var s;return s=e.name,void(l?.(s),t(s),h(!1))},className:"search-bar__option",children:[e.image_url?(0,s.jsx)("img",{src:e.image_url,alt:e.name,className:"search-bar__avatar"}):(0,s.jsx)("span",{className:"search-bar__avatar search-bar__avatar--placeholder",children:e.name.charAt(0)}),(0,s.jsx)("span",{className:"search-bar__option-text",children:e.name})]})},e.name))})}):(0,s.jsx)("div",{className:"search-bar__empty",children:n})})]})})}function i({lives:e,maxLives:a=10}){let r=Math.max(0,Math.min(100,e/a*100));return(0,s.jsx)("div",{className:"life-bar__track",children:(0,s.jsxs)("div",{className:"life-bar__fill",style:{width:`${r}%`},children:[e,"/",a]})})}var l=e.i(97936),n=e.i(1892),d=e.i(17927);let o=async e=>{let{data:s}=await d.supabase.from("profiles").select("games_played").eq("id",e).single();if(!s)return;let{error:a}=await d.supabase.from("profiles").update({games_played:(s.games_played||0)+1}).eq("id",e);if(a)throw console.error("Error incrementing games_played:",a),a},m=async e=>{let{data:s}=await d.supabase.from("profiles").select("wins").eq("id",e).single();if(!s)return;let{error:a}=await d.supabase.from("profiles").update({wins:(s.wins||0)+1}).eq("id",e);if(a)throw console.error("Error incrementing wins:",a),a};function u(){let e=(0,r.useRouter)(),[c,u]=(0,a.useState)(""),[h,_]=(0,a.useState)(10),[g,p]=(0,a.useState)([]),[x,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),[b,S]=(0,a.useState)([]),[y,C]=(0,a.useState)(!0),[L,k]=(0,a.useState)(!1),E=()=>new Date().toISOString().slice(0,10),$="realingdle:game-state";(0,a.useEffect)(()=>{A()},[]),(0,a.useEffect)(()=>{(async()=>{let{data:e}=await d.supabase.auth.getSession();k(e.session?.user?.app_metadata?.role==="admin")})();let{data:e}=d.supabase.auth.onAuthStateChange((e,s)=>{k(s?.user?.app_metadata?.role==="admin")});return()=>{e.subscription.unsubscribe()}},[]);let A=async()=>{try{let e=await (0,n.fetchCharacters)({ascending:!0});S(e);let s=new Date().toISOString().split("T")[0],{data:a,error:r}=await d.supabase.from("daily_characters").select("character_id").eq("date",s).maybeSingle();if(r)throw r;let c=e.find(e=>e.id===a?.character_id);if(!c)throw Error("Daily character not found");v(c);{let e=window.localStorage.getItem($);if(e)try{let s=JSON.parse(e);s.dateKey===E()&&s.characterId===c.id?(p(s.guesses),_(s.lives),j(s.gameOver),N(s.won)):window.localStorage.removeItem($)}catch{window.localStorage.removeItem($)}}}catch(e){console.error("Error fetching character:",e)}C(!1)};(0,a.useEffect)(()=>{if(!f)return;let e={dateKey:E(),characterId:f.id,guesses:g,lives:h,gameOver:x,won:w};window.localStorage.setItem($,JSON.stringify(e))},[f,g,h,x,w]);let I=async e=>{if(x||!f)return;let s=b.find(s=>s.name.toLowerCase()===e.toLowerCase());if(!s)return void u("");let a=[...g,s.name];if(0===g.length){let{data:e}=await d.supabase.auth.getSession();if(e.session?.user?.id)try{await o(e.session.user.id)}catch(e){console.error("Failed to increment games_played:",e)}}if(p(a),s.name.toLowerCase()===f.name.toLowerCase()){N(!0),j(!0);let{data:e}=await d.supabase.auth.getSession();if(e.session?.user?.id)try{await m(e.session.user.id)}catch(e){console.error("Failed to increment wins:",e)}}else{let e=h-1;_(e),0===e&&j(!0)}u("")},O=new Set(g.map(e=>e.toLowerCase())),T=c.trim().length?b.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())).filter(e=>!O.has(e.name.toLowerCase())).map(e=>({name:e.name,image_url:e.image_url})):[],q=(e,a,r="None")=>{let c=new Set(a.map(e=>e.id));return 0===e.length?(0,s.jsx)("span",{className:"guess-chip guess-chip--miss",children:r}):e.map(e=>(0,s.jsx)("span",{className:`guess-chip ${c.has(e.id)?"guess-chip--match":"guess-chip--miss"}`,children:e.name},e.id))};return y?(0,s.jsx)("div",{className:"game",children:(0,s.jsx)("div",{className:"game__container",children:(0,s.jsx)("p",{children:"Loading..."})})}):f?(0,s.jsx)("div",{className:"game",children:(0,s.jsxs)("div",{className:"game__container",children:[(0,s.jsx)("h1",{className:"game__title",children:"Guess the Character"}),(0,s.jsx)(i,{lives:h,maxLives:10}),!x&&(0,s.jsx)("div",{className:"game__search",children:(0,s.jsx)(t,{value:c,onChange:u,onSubmit:I,suggestions:T,onSelectSuggestion:e=>u(e),noResultsText:"No characters found",disabled:x})}),x&&(0,s.jsxs)("div",{className:`game__result ${w?"game__result--win":"game__result--lose"}`,children:[(0,s.jsx)("h2",{children:w?"ðŸŽ‰ Congratulations!":"ðŸ˜¢ Game Over"}),(0,s.jsx)("p",{children:w?`You guessed the character "${f.name}" correctly!`:`The character was "${f.name}"`}),L&&(0,s.jsx)("div",{className:"game__actions",children:(0,s.jsx)(l.default,{onClick:()=>{_(10),p([]),j(!1),N(!1),u(""),window.localStorage.removeItem($),A()},children:"Play Again"})})]}),(0,s.jsx)("div",{className:"game__guesses",children:(0,s.jsx)("ul",{className:"game__guesses-list",children:[...g].reverse().map((e,a)=>{let r=b.find(s=>s.name.toLowerCase()===e.toLowerCase())||null,c=r?.id===f?.id||e.toLowerCase()===f?.name.toLowerCase();if(!r||!f)return(0,s.jsxs)("li",{className:"game__guess-card game__guess-card--unknown",children:[(0,s.jsxs)("div",{className:"game__guess-header",children:[(0,s.jsx)("span",{className:"game__guess-name",children:e}),(0,s.jsx)("span",{className:"game__guess-status",children:"Unknown"})]}),(0,s.jsx)("p",{className:"game__guess-missing",children:"Character not found."})]},a);let t={state:r.state?.id===f.state?.id,age:(r.age??null)===(f.age??null)},i=r.image_url?{"--guess-image":`url(${r.image_url})`}:void 0;return(0,s.jsx)("li",{className:`game__guess-card ${c?"game__guess-card--correct":"game__guess-card--wrong"}`,style:i,children:(0,s.jsx)("div",{className:"guess-card__content",children:(0,s.jsxs)("div",{className:"guess-card__info",children:[(0,s.jsxs)("div",{className:"guess-card__title",children:[(0,s.jsx)("h4",{children:r.name}),r.description&&(0,s.jsxs)("p",{className:"guess-card__quote",children:["â€œ",r.description,"â€"]})]}),(0,s.jsxs)("div",{className:"guess-card__row-group",children:[(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Age"}),(0,s.jsx)("div",{className:"guess-card__chips",children:(0,s.jsx)("span",{className:`guess-chip ${t.age?"guess-chip--match":"guess-chip--miss"}`,children:r.age??"-"})})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"State"}),(0,s.jsx)("div",{className:"guess-card__chips",children:(0,s.jsx)("span",{className:`guess-chip ${t.state?"guess-chip--match":"guess-chip--miss"}`,children:r.state?.name||"-"})})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Classes"}),(0,s.jsx)("div",{className:"guess-card__chips",children:q(r.classes,f.classes)})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Races"}),(0,s.jsx)("div",{className:"guess-card__chips",children:q(r.races,f.races)})]})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Occupations"}),(0,s.jsx)("div",{className:"guess-card__chips",children:q(r.occupations,f.occupations)})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Associations"}),(0,s.jsx)("div",{className:"guess-card__chips",children:q(r.associations,f.associations)})]}),(0,s.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,s.jsx)("span",{className:"guess-card__label",children:"Places"}),(0,s.jsx)("div",{className:"guess-card__chips",children:q(r.places,f.places)})]})]})})},a)})})})]})}):(0,s.jsx)("div",{className:"game",children:(0,s.jsxs)("div",{className:"game__container",children:[(0,s.jsx)("h2",{children:"No characters available"}),(0,s.jsx)("p",{children:"Please contact the administrator to add characters."}),(0,s.jsx)(l.default,{onClick:()=>e.push("/"),children:"Back to Home"})]})})}e.s(["default",()=>u],8134)}]);