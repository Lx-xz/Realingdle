(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35174,e=>{"use strict";var a=e.i(43476);let s=(0,e.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);function t({label:e="Loading...",compact:t=!1,light:r=!1}){return(0,a.jsxs)("div",{className:`loading ${t?"loading--compact":""} ${r?"loading--light":""}`.trim(),role:"status","aria-live":"polite",children:[(0,a.jsx)(s,{className:"loading__icon"}),e?(0,a.jsx)("span",{className:"loading__label",children:e}):null]})}e.s(["default",()=>t],35174)},97936,e=>{"use strict";var a=e.i(43476);function s({children:e,onClick:s,type:t="button",variant:r="primary",disabled:i=!1}){return(0,a.jsx)("button",{className:`button button--${r}`,onClick:s,type:t,disabled:i,children:e})}e.s(["default",()=>s])},1892,e=>{"use strict";var a=e.i(17927);let s=`
  id,
  name,
  description,
  image_url,
  age,
  created_at,
  updated_at,
  state:states(id, name),
  classes:character_classes(class:classes(id, name)),
  races:character_races(race:races(id, name)),
  occupations:character_occupations(occupation:occupations(id, name)),
  associations:character_associations(association:associations(id, name)),
  places:character_places(place:places(id, name))
`,t=e=>({id:e.id,name:e.name,description:e.description,image_url:e.image_url,age:e.age,created_at:e.created_at,updated_at:e.updated_at,state:Array.isArray(e.state)?e.state[0]:e.state,classes:e.classes?.map(e=>e.class)??[],races:e.races?.map(e=>e.race)??[],occupations:e.occupations?.map(e=>e.occupation)??[],associations:e.associations?.map(e=>e.association)??[],places:e.places?.map(e=>e.place)??[]}),r=async(e={})=>{let{data:r,error:i}=await a.supabase.from("characters").select(s).order("name",{ascending:e.ascending??!0});if(i)throw i;return r.map(t)};e.s(["fetchCharacters",0,r])},8134,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(18566),r=e.i(75254);let i=(0,r.default)("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),c=(0,r.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var l=e.i(4048);function n({value:e,onChange:t,onSubmit:r,suggestions:i=[],onSelectSuggestion:c,noResultsText:n="No results",placeholder:d="Search character...",disabled:o=!1}){let u=(0,s.useRef)(null),[m,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=e=>{u.current&&(u.current.contains(e.target)||h(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let _=m&&e.trim().length>0,g=i.length>0;return(0,a.jsx)("form",{className:"search-bar",onSubmit:a=>{a.preventDefault(),e.trim()&&(r(e.trim()),h(!1))},children:(0,a.jsxs)("div",{className:"search-bar__field",ref:u,children:[(0,a.jsx)("input",{type:"text",className:"search-bar__input",value:e,onChange:e=>{t(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:d,disabled:o}),_&&(0,a.jsx)("div",{className:"search-bar__dropdown",children:(0,a.jsx)("div",{className:"search-bar__dropdown-content",children:g?(0,a.jsx)(l.default,{className:"search-bar__scroll",children:(0,a.jsx)("ul",{className:"search-bar__list",children:i.map(e=>(0,a.jsx)("li",{className:"search-bar__item",children:(0,a.jsxs)("button",{type:"button",onClick:()=>{var a;return a=e.name,void(c?.(a),r(a),h(!1))},className:"search-bar__option",children:[e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"search-bar__avatar"}):(0,a.jsx)("span",{className:"search-bar__avatar search-bar__avatar--placeholder",children:e.name.charAt(0)}),(0,a.jsx)("span",{className:"search-bar__option-text",children:e.name})]})},e.name))})}):(0,a.jsx)("div",{className:"search-bar__empty",children:n})})})]})})}function d({lives:e,maxLives:s=10}){let t=Math.max(0,Math.min(100,e/s*100));return(0,a.jsx)("div",{className:"life-bar__track",children:(0,a.jsxs)("div",{className:"life-bar__fill",style:{width:`${t}%`},children:[e,"/",s]})})}var o=e.i(97936),u=e.i(35174),m=e.i(1892),h=e.i(17927);let _=async e=>{let{data:a}=await h.supabase.from("profiles").select("games_played").eq("id",e).single();if(!a)return;let{error:s}=await h.supabase.from("profiles").update({games_played:(a.games_played||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing games_played:",s),s},g=async e=>{let{data:a}=await h.supabase.from("profiles").select("wins").eq("id",e).single();if(!a)return;let{error:s}=await h.supabase.from("profiles").update({wins:(a.wins||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing wins:",s),s};function p(){return(0,a.jsx)(f,{})}function f({forcedDate:e}){let r=(0,t.useRouter)(),[l,p]=(0,s.useState)(""),[f,x]=(0,s.useState)(10),[w,v]=(0,s.useState)([]),[j,N]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[S,k]=(0,s.useState)(null),[C,$]=(0,s.useState)([]),[E,M]=(0,s.useState)(!0),[L,q]=(0,s.useState)(null),[A,I]=(0,s.useState)(!1),[O,R]=(0,s.useState)([]),[T,F]=(0,s.useState)(!1),[P,K]=(0,s.useState)(!1),[U,B]=(0,s.useState)(!1),[D,G]=(0,s.useState)({}),J=()=>new Date().toISOString().slice(0,10),z=(0,s.useMemo)(()=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e)?e:J(),[e]),H=`realingdle:game-state:v3:${z}`;(0,s.useEffect)(()=>{Y()},[z]),(0,s.useEffect)(()=>{(async()=>{let{data:e}=await h.supabase.auth.getSession();q(e.session?.user?.id??null)})();let{data:e}=h.supabase.auth.onAuthStateChange((e,a)=>{q(a?.user?.id??null)});return()=>{e.subscription.unsubscribe()}},[]);let V=async()=>{if(U)return;B(!0);let{data:e,error:a}=await h.supabase.from("daily_characters").select("date").order("date",{ascending:!1});if(a){console.error("Error loading available game dates:",a),B(!1);return}R((e??[]).map(e=>e.date).filter(e=>"string"==typeof e));let{data:s}=await h.supabase.auth.getSession(),t=s.session?.user?.id;if(!t){G({}),K(!0),B(!1);return}let{data:r,error:i}=await h.supabase.from("daily_game_attempts").select("game_date, won, lives_remaining").eq("user_id",t);if(i){console.error("Error loading date statuses:",i),G({}),K(!0),B(!1);return}let c={};(r??[]).forEach(e=>{let a=e.game_date;"string"==typeof a&&(e.won?c[a]="won":(e.lives_remaining??0)<=0?c[a]="lost":c[a]="in-progress")}),G(c),K(!0),B(!1)};(0,s.useEffect)(()=>{P||U||V()},[]);let Y=async()=>{I(!1),M(!0);try{let e=await (0,m.fetchCharacters)({ascending:!0});$(e);let{data:a}=await h.supabase.auth.getSession(),s=a.session?.user?.id??null;s&&q(s);let{data:t,error:r}=await h.supabase.from("daily_characters").select("character_id").eq("date",z).maybeSingle();if(r)throw r;let i=e.find(e=>e.id===t?.character_id);if(!i)throw Error("Daily character not found");if(k(i),s){let{data:e,error:a}=await h.supabase.from("daily_game_attempts").select("guesses, lives_remaining, won").eq("user_id",s).eq("game_date",z).maybeSingle();if(a&&console.error("Error loading saved attempt:",a),e){let a=Array.isArray(e.guesses)?e.guesses.filter(e=>"string"==typeof e):[];v(a);let s=Math.max(0,Math.min(e.lives_remaining??10,10)),t=!!e.won;x(s),b(t),N(t||0===s),I(!0);return}}{let e=window.localStorage.getItem(H);if(e)try{let a=JSON.parse(e);if(a.dateKey===z&&a.characterId===i.id){v(a.guesses);let e=Math.max(0,Math.min(a.lives,10)),s=!!a.won;x(e),b(s),N(s||0===e)}else window.localStorage.removeItem(H)}catch{window.localStorage.removeItem(H)}}}catch(e){console.error("Error fetching character:",e)}finally{I(!0),M(!1)}},Q=async e=>{let{data:a,error:s}=await h.supabase.rpc("daily_guess",{guess_character_id:e,game_date:z});if(s)throw s;return a&&"object"==typeof a&&"boolean"==typeof a.is_correct?a.is_correct:null},W=async()=>{let{data:e,error:a}=await h.supabase.rpc("daily_character_reveal",{game_date:z});if(a)throw a;let s=C.find(a=>a.id===e);s&&k(s)};(0,s.useEffect)(()=>{if(!S)return;let e={dateKey:z,characterId:S.id,guesses:w,lives:f,won:y};window.localStorage.setItem(H,JSON.stringify(e))},[S,w,f,y,z,H]),(0,s.useEffect)(()=>{S&&A&&L&&(async()=>{let{error:e}=await h.supabase.from("daily_game_attempts").upsert({user_id:L,game_date:z,lives_remaining:f,guesses:w,won:y},{onConflict:"user_id,game_date"});e&&console.error("Error saving daily attempt:",e)})()},[S,w,f,y,L,A,z]);let X=async e=>{if(j||!S)return;let a=C.find(a=>a.name.toLowerCase()===e.toLowerCase());if(!a)return void p("");let s=[...w,a.id];if(0===w.length){let{data:e}=await h.supabase.auth.getSession();if(e.session?.user?.id)try{await _(e.session.user.id)}catch(e){console.error("Failed to increment games_played:",e)}}v(s);let t=null;try{t=await Q(a.id)}catch(e){console.error("Failed to validate guess on backend:",e)}if(t??a.name.toLowerCase()===S.name.toLowerCase()){b(!0),N(!0);let{data:e}=await h.supabase.auth.getSession();if(e.session?.user?.id)try{await g(e.session.user.id)}catch(e){console.error("Failed to increment wins:",e)}}else{let e=f-1;if(x(e),0===e){N(!0);try{await W()}catch(e){console.error("Failed to reveal character on defeat:",e)}}}p("")},Z=e=>C.find(a=>a.id===e)||null,ee=new Set(w.map(e=>Z(e)?.id).filter(e=>!!e)),ea=l.trim().length?C.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())).filter(e=>!ee.has(e.id)).map(e=>({name:e.name,image_url:e.image_url})):[],es=(e,s,t="None")=>{let r=new Set(s.map(e=>e.id));return 0===e.length?(0,a.jsx)("span",{className:"guess-chip guess-chip--miss",children:t}):e.map(e=>(0,a.jsx)("span",{className:`guess-chip ${r.has(e.id)?"guess-chip--match":"guess-chip--miss"}`,children:e.name},e.id))};return E?(0,a.jsx)("div",{className:"game",children:(0,a.jsx)("div",{className:"game__container",children:(0,a.jsx)(u.default,{label:"Loading..."})})}):S?(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsxs)("div",{className:"game__header",children:[(0,a.jsx)("h1",{className:"game__title",children:"Guess the Character"}),(0,a.jsxs)("div",{className:"game__date-dropdown-wrap",children:[(0,a.jsxs)("button",{type:"button",className:"game__date-trigger",onClick:()=>{F(e=>!e),T||P||V()},children:[(0,a.jsx)(i,{className:"game__date-trigger-icon"}),(0,a.jsx)("span",{children:(e=>{let[a,s,t]=e.split("-");return a&&s&&t?`${t}/${s}/${a}`:e})(z)}),(0,a.jsx)(c,{className:`game__date-trigger-chevron ${T?"game__date-trigger-chevron--open":""}`})]}),T&&(0,a.jsxs)("div",{className:"game__date-dropdown",children:[U&&(0,a.jsx)("div",{className:"game__date-loading",children:(0,a.jsx)(u.default,{label:"Carregando datas...",compact:!0,light:!0})}),(0,a.jsx)("div",{className:"game__date-grid",children:O.map(e=>{let s=D[e],t=e===z?"game__date-chip--selected":"";return(0,a.jsx)("button",{type:"button",className:`game__date-chip ${"won"===s?"game__date-chip--won":"lost"===s?"game__date-chip--lost":"in-progress"===s?"game__date-chip--in-progress":""} ${t}`,onClick:()=>(e=>{if(e===J()){r.push("/game"),F(!1);return}r.push(`/game/${e}`),F(!1)})(e),children:(e=>{let[,a,s]=e.split("-");return a&&s?`${s}/${a}`:e})(e)},e)})})]})]})]}),(0,a.jsx)(d,{lives:f,maxLives:10}),!j&&(0,a.jsx)("div",{className:"game__search",children:(0,a.jsx)(n,{value:l,onChange:p,onSubmit:X,suggestions:ea,onSelectSuggestion:e=>p(e),noResultsText:"No characters found",disabled:j})}),j&&(0,a.jsxs)("div",{className:`game__result ${y?"game__result--win":"game__result--lose"}`,children:[(0,a.jsx)("h2",{children:y?"ðŸŽ‰ Congratulations!":"ðŸ˜¢ Game Over"}),(0,a.jsx)("p",{children:y?`You guessed the character "${S.name}" correctly!`:`The character was "${S.name}"`})]}),(0,a.jsx)("div",{className:"game__guesses",children:(0,a.jsx)("ul",{className:"game__guesses-list",children:[...w].reverse().map((e,s)=>{let t=Z(e),r=t?.id===S?.id;if(!t||!S)return(0,a.jsxs)("li",{className:"game__guess-card game__guess-card--unknown",children:[(0,a.jsxs)("div",{className:"game__guess-header",children:[(0,a.jsx)("span",{className:"game__guess-name",children:"Unknown character"}),(0,a.jsx)("span",{className:"game__guess-status",children:"Unknown"})]}),(0,a.jsx)("p",{className:"game__guess-missing",children:"Character not found."})]},s);let i={state:t.state?.id===S.state?.id,age:(t.age??null)===(S.age??null)},c=t.image_url?{"--guess-image":`url(${t.image_url})`}:void 0;return(0,a.jsx)("li",{className:`game__guess-card ${r?"game__guess-card--correct":"game__guess-card--wrong"}`,style:c,children:(0,a.jsx)("div",{className:"guess-card__content",children:(0,a.jsxs)("div",{className:"guess-card__info",children:[(0,a.jsxs)("div",{className:"guess-card__title",children:[(0,a.jsx)("h4",{children:t.name}),t.description&&(0,a.jsxs)("p",{className:"guess-card__quote",children:["â€œ",t.description,"â€"]})]}),(0,a.jsxs)("div",{className:"guess-card__row-group",children:[(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Age"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${i.age?"guess-chip--match":"guess-chip--miss"}`,children:t.age??"-"})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"State"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${i.state?"guess-chip--match":"guess-chip--miss"}`,children:t.state?.name||"-"})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Classes"}),(0,a.jsx)("div",{className:"guess-card__chips",children:es(t.classes,S.classes)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Races"}),(0,a.jsx)("div",{className:"guess-card__chips",children:es(t.races,S.races)})]})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Occupations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:es(t.occupations,S.occupations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Associations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:es(t.associations,S.associations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Places"}),(0,a.jsx)("div",{className:"guess-card__chips",children:es(t.places,S.places)})]})]})})},s)})})})]})}):(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("h2",{children:"No characters available"}),(0,a.jsx)("p",{children:"Please contact the administrator to add characters."}),(0,a.jsx)(o.default,{onClick:()=>r.push("/"),children:"Back to Home"})]})})}e.s(["GamePageContent",()=>f,"default",()=>p],8134)}]);