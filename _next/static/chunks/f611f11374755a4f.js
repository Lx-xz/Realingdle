(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35174,a=>{"use strict";var e=a.i(43476);let l=(0,a.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);function s({label:a="Loading...",compact:s=!1,light:r=!1}){return(0,e.jsxs)("div",{className:`loading ${s?"loading--compact":""} ${r?"loading--light":""}`.trim(),role:"status","aria-live":"polite",children:[(0,e.jsx)(l,{className:"loading__icon"}),a?(0,e.jsx)("span",{className:"loading__label",children:a}):null]})}a.s(["default",()=>s],35174)},88699,a=>{"use strict";let e=(0,a.i(75254).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.s(["Pencil",()=>e],88699)},2153,a=>{"use strict";var e=a.i(43476),l=a.i(71645),s=a.i(18566),r=a.i(88699),i=a.i(17927),t=a.i(35174);function o(){let a=(0,s.useRouter)(),[o,d]=(0,l.useState)(null),[n,c]=(0,l.useState)(null),[p,m]=(0,l.useState)(!1),[u,f]=(0,l.useState)({displayName:"",avatarUrl:"",email:"",newPassword:"",confirmPassword:""}),[_,h]=(0,l.useState)(""),[v,w]=(0,l.useState)(""),[j,x]=(0,l.useState)(!0),[N,b]=(0,l.useState)(null),[y,g]=(0,l.useState)(!1),[U,P]=(0,l.useState)("url"),[C,S]=(0,l.useState)(""),k=a=>a?a.includes("/storage/v1/object/avatars/")?a.replace("/storage/v1/object/avatars/","/storage/v1/object/public/avatars/"):a:null,L=async a=>{let{data:e,error:l}=await i.supabase.from("profiles").select("id, display_name, avatar_url, games_played, wins").eq("id",a.id).maybeSingle();if(l)return void console.error("Error loading profile",l);if(!e){let e=`Guest-${a.id.slice(0,6)}`,{data:l,error:s}=await i.supabase.from("profiles").insert({id:a.id,display_name:e,avatar_url:a.user_metadata?.avatar_url??null,games_played:0,wins:0}).select("id, display_name, avatar_url, games_played, wins").single();return s?void console.error("Error creating profile",s):(c(l),void f({displayName:l.display_name,avatarUrl:l.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""}))}c(e),f({displayName:e.display_name,avatarUrl:e.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""})};if((0,l.useEffect)(()=>{(async()=>{let{data:e}=await i.supabase.auth.getSession();if(!e.session)return a.replace("/auth?next=/profile");let l=e.session.user;d(l),await L(l),x(!1)})()},[a]),(0,l.useEffect)(()=>{if(!p)return void S("");let a=null;return"upload"===U&&N?S(a=URL.createObjectURL(N)):"url"===U&&u.avatarUrl.trim()?S(u.avatarUrl.trim()):S(""),()=>{a&&URL.revokeObjectURL(a)}},[N,U,u.avatarUrl,p]),j)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:(0,e.jsx)(t.default,{label:"Loading profile..."})})});if(!o)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:"Redirecting to login..."})});let R=async a=>{if(a.preventDefault(),o&&n){h(""),w(""),g(!1);try{let a="url"===U?k(u.avatarUrl.trim()):null;if("upload"===U&&N){g(!0);let e=N.name.split(".").pop(),l=e?e.toLowerCase():"png",s=`${o.id}/${Date.now()}-avatar.${l}`,{error:r}=await i.supabase.storage.from("avatars").upload(s,N,{upsert:!0});if(r)throw r;let{data:t}=i.supabase.storage.from("avatars").getPublicUrl(s);if(!t?.publicUrl)throw Error("Unable to get avatar URL");a=k(t.publicUrl),f(e=>({...e,avatarUrl:a||t.publicUrl})),b(null)}if(u.email&&u.email!==o.email){let{error:a}=await i.supabase.auth.updateUser({email:u.email});if(a)throw a}if(u.newPassword){if(u.newPassword!==u.confirmPassword)throw Error("Passwords do not match");let{error:a}=await i.supabase.auth.updateUser({password:u.newPassword});if(a)throw a}let{error:e}=await i.supabase.from("profiles").upsert({id:o.id,display_name:u.displayName.trim()||n.display_name,avatar_url:a});if(e)throw e;if(a){let{error:e}=await i.supabase.auth.updateUser({data:{avatar_url:a}});if(e)throw e}await L(o),m(!1),h("Profile updated"),f(a=>({...a,newPassword:"",confirmPassword:""}))}catch(a){w(a.message||"Unable to update profile")}finally{g(!1)}}},F=C||n?.avatar_url||o.user_metadata?.avatar_url,E=n?.display_name?.charAt(0)?.toUpperCase()||o.email?.charAt(0)?.toUpperCase()||"?";return(0,e.jsx)("div",{className:"profile",children:(0,e.jsxs)("div",{className:"profile__card",children:[(0,e.jsxs)("div",{className:"profile__header",children:[(0,e.jsx)("div",{className:"profile__avatar",children:F?(0,e.jsx)("img",{src:F,alt:"User avatar"}):(0,e.jsx)("span",{children:E})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"profile__title",children:"Profile"}),(0,e.jsx)("p",{className:"profile__subtitle",children:"Account details"})]}),(0,e.jsx)("button",{type:"button",className:"profile__edit",onClick:()=>m(!0),"aria-label":"Edit profile",children:(0,e.jsx)(r.Pencil,{size:18})})]}),p?(0,e.jsxs)("form",{className:"profile__form",onSubmit:R,children:[(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"displayName",children:"Display name"}),(0,e.jsx)("input",{id:"displayName",type:"text",value:u.displayName,onChange:a=>f({...u,displayName:a.target.value}),required:!0})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{children:"Avatar source"}),(0,e.jsxs)("div",{className:"profile__switch",children:[(0,e.jsx)("button",{type:"button",className:"url"===U?"is-active":"",onClick:()=>P("url"),children:"URL"}),(0,e.jsx)("button",{type:"button",className:"upload"===U?"is-active":"",onClick:()=>P("upload"),children:"Upload"})]})]}),"url"===U?(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarUrl",children:"Avatar URL"}),(0,e.jsx)("input",{id:"avatarUrl",type:"url",value:u.avatarUrl,onChange:a=>f({...u,avatarUrl:a.target.value}),placeholder:"https://"})]}):(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarFile",children:"Upload avatar"}),(0,e.jsxs)("div",{className:"profile__upload",children:[(0,e.jsx)("input",{id:"avatarFile",type:"file",accept:"image/*",onChange:a=>b(a.target.files?.[0]??null)}),(0,e.jsx)("label",{htmlFor:"avatarFile",className:"profile__file-button",children:"Choose image"}),(0,e.jsx)("span",{className:"profile__file-name",children:N?.name||"No file selected"})]}),(0,e.jsx)("p",{className:"profile__upload-note",children:"The file will be uploaded when you save changes."})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"email",children:"Email"}),(0,e.jsx)("input",{id:"email",type:"email",value:u.email,onChange:a=>f({...u,email:a.target.value})})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"newPassword",children:"New password"}),(0,e.jsx)("input",{id:"newPassword",type:"password",value:u.newPassword,onChange:a=>f({...u,newPassword:a.target.value}),autoComplete:"new-password"})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm password"}),(0,e.jsx)("input",{id:"confirmPassword",type:"password",value:u.confirmPassword,onChange:a=>f({...u,confirmPassword:a.target.value}),autoComplete:"new-password"})]}),_&&(0,e.jsx)("p",{className:"profile__message",children:_}),v&&(0,e.jsx)("p",{className:"profile__error",children:v}),(0,e.jsxs)("div",{className:"profile__actions",children:[(0,e.jsx)("button",{type:"submit",className:"profile__save",children:y?"Saving...":"Save changes"}),(0,e.jsx)("button",{type:"button",className:"profile__cancel",onClick:()=>{o&&n&&(m(!1),h(""),w(""),b(null),P("url"),f({displayName:n.display_name,avatarUrl:n.avatar_url||"",email:o.email||"",newPassword:"",confirmPassword:""}))},children:"Cancel"})]})]}):(0,e.jsxs)("div",{className:"profile__info",children:[(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Display name"}),(0,e.jsx)("span",{className:"profile__value",children:n?.display_name||"-"})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Email"}),(0,e.jsx)("span",{className:"profile__value",children:o.email})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Games played"}),(0,e.jsx)("span",{className:"profile__value",children:n?.games_played??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Wins"}),(0,e.jsx)("span",{className:"profile__value",children:n?.wins??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"User ID"}),(0,e.jsx)("span",{className:"profile__value",children:o.id})]})]})]})})}a.s(["default",()=>o])}]);