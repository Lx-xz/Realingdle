(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35174,e=>{"use strict";var a=e.i(43476);let s=(0,e.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);function r({label:e="Loading...",compact:r=!1,light:t=!1}){return(0,a.jsxs)("div",{className:`loading ${r?"loading--compact":""} ${t?"loading--light":""}`.trim(),role:"status","aria-live":"polite",children:[(0,a.jsx)(s,{className:"loading__icon"}),e?(0,a.jsx)("span",{className:"loading__label",children:e}):null]})}e.s(["default",()=>r],35174)},97936,e=>{"use strict";var a=e.i(43476);function s({children:e,onClick:s,type:r="button",variant:t="primary",disabled:c=!1}){return(0,a.jsx)("button",{className:`button button--${t}`,onClick:s,type:r,disabled:c,children:e})}e.s(["default",()=>s])},1892,e=>{"use strict";var a=e.i(17927);let s=`
  id,
  name,
  description,
  image_url,
  age,
  created_at,
  updated_at,
  state:states(id, name),
  classes:character_classes(class:classes(id, name)),
  races:character_races(race:races(id, name)),
  occupations:character_occupations(occupation:occupations(id, name)),
  associations:character_associations(association:associations(id, name)),
  places:character_places(place:places(id, name))
`,r=e=>({id:e.id,name:e.name,description:e.description,image_url:e.image_url,age:e.age,created_at:e.created_at,updated_at:e.updated_at,state:Array.isArray(e.state)?e.state[0]:e.state,classes:e.classes?.map(e=>e.class)??[],races:e.races?.map(e=>e.race)??[],occupations:e.occupations?.map(e=>e.occupation)??[],associations:e.associations?.map(e=>e.association)??[],places:e.places?.map(e=>e.place)??[]}),t=async(e={})=>{let{data:t,error:c}=await a.supabase.from("characters").select(s).order("name",{ascending:e.ascending??!0});if(c)throw c;return t.map(r)};e.s(["fetchCharacters",0,t])},8134,e=>{"use strict";var a=e.i(43476),s=e.i(71645),r=e.i(18566),t=e.i(75254);let c=(0,t.default)("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),i=(0,t.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var l=e.i(9915),n=e.i(4048);function d({value:e,onChange:r,onSubmit:t,suggestions:c=[],onSelectSuggestion:i,noResultsText:l="No results",placeholder:d="Search character...",disabled:o=!1}){let m=(0,s.useRef)(null),[u,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=e=>{m.current&&(m.current.contains(e.target)||h(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let g=u&&e.trim().length>0,_=c.length>0;return(0,a.jsx)("form",{className:"search-bar",onSubmit:a=>{a.preventDefault(),e.trim()&&(t(e.trim()),h(!1))},children:(0,a.jsxs)("div",{className:"search-bar__field",ref:m,children:[(0,a.jsx)("input",{type:"text",className:"search-bar__input",value:e,onChange:e=>{r(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:d,disabled:o}),g&&(0,a.jsx)("div",{className:"search-bar__dropdown",children:(0,a.jsx)("div",{className:"search-bar__dropdown-content",children:_?(0,a.jsx)(n.default,{className:"search-bar__scroll",children:(0,a.jsx)("ul",{className:"search-bar__list",children:c.map(e=>(0,a.jsx)("li",{className:"search-bar__item",children:(0,a.jsxs)("button",{type:"button",onMouseDown:a=>{var s;a.preventDefault(),s=e.name,i?.(s),t(s),h(!1)},className:"search-bar__option",children:[e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"search-bar__avatar"}):(0,a.jsx)("span",{className:"search-bar__avatar search-bar__avatar--placeholder",children:e.name.charAt(0)}),(0,a.jsx)("span",{className:"search-bar__option-text",children:e.name})]})},e.name))})}):(0,a.jsx)("div",{className:"search-bar__empty",children:l})})})]})})}function o({lives:e,maxLives:s=10}){let r=Math.max(0,Math.min(100,e/s*100));return(0,a.jsx)("div",{className:"life-bar__track",children:(0,a.jsxs)("div",{className:"life-bar__fill",style:{width:`${r}%`},children:[e,"/",s]})})}var m=e.i(97936),u=e.i(35174),h=e.i(1892),g=e.i(17927);let _=async e=>{let{data:a}=await g.supabase.from("profiles").select("games_played").eq("id",e).single();if(!a)return;let{error:s}=await g.supabase.from("profiles").update({games_played:(a.games_played||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing games_played:",s),s},p=async e=>{let{data:a}=await g.supabase.from("profiles").select("wins").eq("id",e).single();if(!a)return;let{error:s}=await g.supabase.from("profiles").update({wins:(a.wins||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing wins:",s),s},f=async(e,a,s)=>{let r;try{return await Promise.race([Promise.resolve(e),new Promise((e,t)=>{r=setTimeout(()=>{t(Error(`${s} timed out`))},a)})])}finally{r&&clearTimeout(r)}},w=e=>new Promise(a=>{setTimeout(a,e)}),x=async(e,a,s)=>{let r;for(let s=0;s<a;s+=1)try{return await e()}catch(e){r=e,s<a-1&&await w(400*2**s)}throw Error(`${s} failed after ${a} attempts: ${r instanceof Error?r.message:String(r)}`)};function v(){return(0,a.jsx)(j,{})}function j({forcedDate:e}){let t=(0,r.useRouter)(),{user:n}=(0,l.useAuthSession)(),[w,v]=(0,s.useState)(""),[j,y]=(0,s.useState)(10),[N,b]=(0,s.useState)([]),[S,k]=(0,s.useState)(!1),[$,C]=(0,s.useState)(!1),[M,A]=(0,s.useState)(!1),[E,I]=(0,s.useState)(null),[L,q]=(0,s.useState)([]),[D,O]=(0,s.useState)(!0),[P,T]=(0,s.useState)(""),[R,F]=(0,s.useState)(!1),[J,K]=(0,s.useState)([]),[U,B]=(0,s.useState)(!1),[G,z]=(0,s.useState)(!1),[H,V]=(0,s.useState)(!1),[Y,Q]=(0,s.useState)({}),W=(0,s.useRef)(null),X=(0,s.useRef)(0),Z=()=>new Date().toISOString().slice(0,10),ee=(0,s.useMemo)(()=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e)?e:Z(),[e]),ea=n?.id??null,es=ee===Z(),er=`realingdle:game-state:v3:${ee}`;(0,s.useEffect)(()=>{ec()},[ee]);let et=async()=>{if(H)return;V(!0);let{data:e,error:a}=await x(()=>f(g.supabase.from("daily_characters").select("date").order("date",{ascending:!1}),1e4,"Available dates fetch"),2,"Available dates fetch");if(a){console.error("Error loading available game dates:",a),V(!1);return}K((e??[]).map(e=>e.date).filter(e=>"string"==typeof e));let s=n?.id;if(!s){Q({}),z(!0),V(!1);return}let{data:r,error:t}=await x(()=>f(g.supabase.from("daily_game_attempts").select("game_date, won, found, lives_remaining").eq("user_id",s),1e4,"Date statuses fetch"),2,"Date statuses fetch");if(t){console.error("Error loading date statuses:",t),Q({}),z(!0),V(!1);return}let c={};(r??[]).forEach(e=>{let a=e.game_date;"string"==typeof a&&(e.won||e.found?c[a]="won":(e.lives_remaining??0)<=0?c[a]="lost":c[a]="in-progress")}),Q(c),z(!0),V(!1)};(0,s.useEffect)(()=>{G||H||et()},[n?.id]);let ec=async()=>{if(W.current)return W.current;let e=(async()=>{let e=++X.current,a="realingdle:characters-cache:v1";F(!1),T("");let s=!1;try{let e=window.localStorage.getItem(a),r=window.localStorage.getItem(er);if(e&&r){let a=JSON.parse(e),t=JSON.parse(r);if(Array.isArray(a.data)&&"number"==typeof a.expiresAt&&a.expiresAt>Date.now()&&t.dateKey===ee){let e=a.data,r=e.find(e=>e.id===t.characterId);if(r){q(e),I(r),b(Array.isArray(t.guesses)?t.guesses:[]);let a=Math.max(0,Math.min(t.lives??10,10)),c=!!t.won,i=!!(t.found??t.won);y(a),C(c),A(i),k(i||0===a),s=!0}}}}catch{window.localStorage.removeItem(a),window.localStorage.removeItem(er)}s?O(!1):(b([]),y(10),C(!1),A(!1),k(!1),O(!0));try{let s=await x(()=>f((0,h.fetchCharacters)({ascending:!0}),15e3,"Characters fetch"),3,"Characters fetch");if(e!==X.current)return;q(s),window.localStorage.setItem(a,JSON.stringify({data:s,expiresAt:Date.now()+3e5}));let r=n?.id??null,{data:t,error:c}=await x(()=>f(g.supabase.from("daily_characters").select("character_id").eq("date",ee).maybeSingle(),12e3,"Daily character fetch"),3,"Daily character fetch");if(c)throw c;let i=s.find(e=>e.id===t?.character_id);if(!i)throw Error("Daily character not found");if(e!==X.current)return;if(I(i),r){let{data:a,error:s}=await x(()=>f(g.supabase.from("daily_game_attempts").select("guesses, lives_remaining, won, found").eq("user_id",r).eq("game_date",ee).maybeSingle(),12e3,"Saved attempt fetch"),2,"Saved attempt fetch");if(s&&console.error("Error loading saved attempt:",s),a){let s=Array.isArray(a.guesses)?a.guesses.filter(e=>"string"==typeof e):[];if(e!==X.current)return;b(s);let r=Math.max(0,Math.min(a.lives_remaining??10,10)),t=!!a.won,c=!!(a.found||a.won);y(r),C(t),A(c),k(c||0===r),F(!0);return}}{let e=window.localStorage.getItem(er);if(e)try{let a=JSON.parse(e);if(a.dateKey===ee&&a.characterId===i.id){b(a.guesses);let e=Math.max(0,Math.min(a.lives,10)),s=!!a.won,r=!!(a.found??a.won);y(e),C(s),A(r),k(r||0===e)}else window.localStorage.removeItem(er)}catch{window.localStorage.removeItem(er)}}}catch(e){console.error("Error fetching character:",e),s||T("Unable to load game right now. Please try again.")}finally{e===X.current&&(F(!0),O(!1))}})().finally(()=>{W.current===e&&(W.current=null)});return W.current=e,e},ei=async e=>{let{data:a,error:s}=await g.supabase.rpc("daily_guess",{guess_character_id:e,game_date:ee});if(s)throw s;return a&&"object"==typeof a&&"boolean"==typeof a.is_correct?a.is_correct:null},el=async()=>{let{data:e,error:a}=await g.supabase.rpc("daily_character_reveal",{game_date:ee});if(a)throw a;let s=L.find(a=>a.id===e);s&&I(s)};(0,s.useEffect)(()=>{if(!E)return;let e={dateKey:ee,characterId:E.id,guesses:N,lives:j,won:$,found:M};window.localStorage.setItem(er,JSON.stringify(e))},[E,N,j,$,M,ee,er]),(0,s.useEffect)(()=>{E&&R&&ea&&0!==N.length&&(async()=>{let{error:e}=await g.supabase.from("daily_game_attempts").upsert({user_id:ea,game_date:ee,lives_remaining:j,guesses:N,won:$,found:M},{onConflict:"user_id,game_date"});e&&console.error("Error saving daily attempt:",e)})()},[E,N,j,$,M,ea,R,ee]);let en=async e=>{if(S||!E)return;let a=L.find(a=>a.name.toLowerCase()===e.toLowerCase());if(!a)return void v("");let s=[...N,a.id];if(0===N.length&&es&&ea)try{await _(ea)}catch(e){console.error("Failed to increment games_played:",e)}b(s);let r=null;try{r=await ei(a.id)}catch(e){console.error("Failed to validate guess on backend:",e)}if(r??a.name.toLowerCase()===E.name.toLowerCase()){if(A(!0),C(es),k(!0),es&&ea)try{await p(ea)}catch(e){console.error("Failed to increment wins:",e)}}else{let e=j-1;if(y(e),0===e){k(!0);try{await el()}catch(e){console.error("Failed to reveal character on defeat:",e)}}}v("")},ed=e=>L.find(a=>a.id===e)||null,eo=new Set(N.map(e=>ed(e)?.id).filter(e=>!!e)),em=w.trim().length?L.filter(e=>e.name.toLowerCase().includes(w.toLowerCase())).filter(e=>!eo.has(e.id)).map(e=>({name:e.name,image_url:e.image_url})):[],eu=(e,s,r="None")=>{let t=new Set(s.map(e=>e.id));return 0===e.length?(0,a.jsx)("span",{className:"guess-chip guess-chip--miss",children:r}):e.map(e=>(0,a.jsx)("span",{className:`guess-chip ${t.has(e.id)?"guess-chip--match":"guess-chip--miss"}`,children:e.name},e.id))};return D?(0,a.jsx)("div",{className:"game",children:(0,a.jsx)("div",{className:"game__container",children:(0,a.jsx)(u.default,{label:"Loading..."})})}):P?(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("h2",{children:"Loading failed"}),(0,a.jsx)("p",{children:P}),(0,a.jsx)(m.default,{onClick:ec,children:"Try again"})]})}):E?(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("div",{className:"game__header",children:(0,a.jsxs)("div",{className:"game__date-dropdown-wrap",children:[(0,a.jsxs)("button",{type:"button",className:"game__date-trigger",onClick:()=>{B(e=>!e),U||G||et()},children:[(0,a.jsx)(c,{className:"game__date-trigger-icon"}),(0,a.jsx)("span",{children:(e=>{let[a,s,r]=e.split("-");return a&&s&&r?`${r}/${s}/${a}`:e})(ee)}),(0,a.jsx)(i,{className:`game__date-trigger-chevron ${U?"game__date-trigger-chevron--open":""}`})]}),U&&(0,a.jsxs)("div",{className:"game__date-dropdown",children:[H&&(0,a.jsx)("div",{className:"game__date-loading",children:(0,a.jsx)(u.default,{label:"Carregando datas...",compact:!0,light:!0})}),(0,a.jsx)("div",{className:"game__date-grid",children:J.map(e=>{let s=Y[e],r=e===ee?"game__date-chip--selected":"";return(0,a.jsx)("button",{type:"button",className:`game__date-chip ${"won"===s?"game__date-chip--won":"lost"===s?"game__date-chip--lost":"in-progress"===s?"game__date-chip--in-progress":""} ${r}`,onClick:()=>(e=>{if(e===Z()){t.push("/game"),B(!1);return}t.push(`/game/${e}`),B(!1)})(e),children:(e=>{let[,a,s]=e.split("-");return a&&s?`${s}/${a}`:e})(e)},e)})})]})]})}),(0,a.jsx)(o,{lives:j,maxLives:10}),!S&&(0,a.jsx)("div",{className:"game__search",children:(0,a.jsx)(d,{value:w,onChange:v,onSubmit:en,suggestions:em,onSelectSuggestion:e=>v(e),noResultsText:"No characters found",disabled:S})}),S&&(0,a.jsxs)("div",{className:`game__result ${M?"game__result--win":"game__result--lose"}`,children:[(0,a.jsx)("h2",{children:M?"ðŸŽ‰ Congratulations!":"ðŸ˜¢ Game Over"}),(0,a.jsx)("p",{children:M?`You guessed the character "${E.name}" correctly!`:`The character was "${E.name}"`})]}),(0,a.jsx)("div",{className:"game__guesses",children:(0,a.jsx)("ul",{className:"game__guesses-list",children:[...N].reverse().map((e,s)=>{let r=ed(e),t=r?.id===E?.id;if(!r||!E)return(0,a.jsxs)("li",{className:"game__guess-card game__guess-card--unknown",children:[(0,a.jsxs)("div",{className:"game__guess-header",children:[(0,a.jsx)("span",{className:"game__guess-name",children:"Unknown character"}),(0,a.jsx)("span",{className:"game__guess-status",children:"Unknown"})]}),(0,a.jsx)("p",{className:"game__guess-missing",children:"Character not found."})]},s);let c={state:r.state?.id===E.state?.id,age:(r.age??null)===(E.age??null)},i=r.image_url?{"--guess-image":`url(${r.image_url})`}:void 0;return(0,a.jsx)("li",{className:`game__guess-card ${t?"game__guess-card--correct":"game__guess-card--wrong"}`,children:(0,a.jsxs)("div",{className:"guess-card__content",children:[(0,a.jsxs)("div",{className:"guess-card__info",children:[(0,a.jsxs)("div",{className:"guess-card__title",children:[(0,a.jsx)("h4",{children:r.name}),r.description&&(0,a.jsxs)("p",{className:"guess-card__quote",children:["â€œ",r.description,"â€"]})]}),(0,a.jsxs)("div",{className:"guess-card__row-group",children:[(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Age"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${c.age?"guess-chip--match":"guess-chip--miss"}`,children:r.age??"-"})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"State"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${c.state?"guess-chip--match":"guess-chip--miss"}`,children:r.state?.name||"-"})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Classes"}),(0,a.jsx)("div",{className:"guess-card__chips",children:eu(r.classes,E.classes)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Races"}),(0,a.jsx)("div",{className:"guess-card__chips",children:eu(r.races,E.races)})]})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Occupations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:eu(r.occupations,E.occupations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Associations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:eu(r.associations,E.associations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Places"}),(0,a.jsx)("div",{className:"guess-card__chips",children:eu(r.places,E.places)})]})]}),(0,a.jsx)("div",{className:"guess-card__image",style:i})]})},s)})})})]})}):(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("h2",{children:"No characters available"}),(0,a.jsx)("p",{children:"Please contact the administrator to add characters."}),(0,a.jsx)(m.default,{onClick:()=>t.push("/"),children:"Back to Home"})]})})}e.s(["GamePageContent",()=>j,"default",()=>v],8134)}]);