(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88699,a=>{"use strict";let e=(0,a.i(75254).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.s(["Pencil",()=>e],88699)},2153,a=>{"use strict";var e=a.i(43476),l=a.i(71645),s=a.i(18566),r=a.i(88699),i=a.i(17927);function t(){let a=(0,s.useRouter)(),[t,o]=(0,l.useState)(null),[n,d]=(0,l.useState)(null),[c,p]=(0,l.useState)(!1),[m,u]=(0,l.useState)({displayName:"",avatarUrl:"",email:"",newPassword:"",confirmPassword:""}),[f,_]=(0,l.useState)(""),[h,v]=(0,l.useState)(""),[w,j]=(0,l.useState)(!0),[x,N]=(0,l.useState)(null),[b,y]=(0,l.useState)(!1),[g,U]=(0,l.useState)("url"),[P,C]=(0,l.useState)(""),S=a=>a?a.includes("/storage/v1/object/avatars/")?a.replace("/storage/v1/object/avatars/","/storage/v1/object/public/avatars/"):a:null,R=async a=>{let{data:e,error:l}=await i.supabase.from("profiles").select("id, display_name, avatar_url, games_played, wins").eq("id",a.id).maybeSingle();if(l)return void console.error("Error loading profile",l);if(!e){let e=`Guest-${a.id.slice(0,6)}`,{data:l,error:s}=await i.supabase.from("profiles").insert({id:a.id,display_name:e,avatar_url:a.user_metadata?.avatar_url??null,games_played:0,wins:0}).select("id, display_name, avatar_url, games_played, wins").single();return s?void console.error("Error creating profile",s):(d(l),void u({displayName:l.display_name,avatarUrl:l.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""}))}d(e),u({displayName:e.display_name,avatarUrl:e.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""})};if((0,l.useEffect)(()=>{(async()=>{let{data:e}=await i.supabase.auth.getSession();if(!e.session)return a.replace("/auth?next=/profile");let l=e.session.user;o(l),await R(l),j(!1)})()},[a]),(0,l.useEffect)(()=>{if(!c)return void C("");let a=null;return"upload"===g&&x?C(a=URL.createObjectURL(x)):"url"===g&&m.avatarUrl.trim()?C(m.avatarUrl.trim()):C(""),()=>{a&&URL.revokeObjectURL(a)}},[x,g,m.avatarUrl,c]),w)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:"Loading profile..."})});if(!t)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:"Redirecting to login..."})});let F=async a=>{if(a.preventDefault(),t&&n){_(""),v(""),y(!1);try{let a="url"===g?S(m.avatarUrl.trim()):null;if("upload"===g&&x){y(!0);let e=x.name.split(".").pop(),l=e?e.toLowerCase():"png",s=`${t.id}/${Date.now()}-avatar.${l}`,{error:r}=await i.supabase.storage.from("avatars").upload(s,x,{upsert:!0});if(r)throw r;let{data:o}=i.supabase.storage.from("avatars").getPublicUrl(s);if(!o?.publicUrl)throw Error("Unable to get avatar URL");a=S(o.publicUrl),u(e=>({...e,avatarUrl:a||o.publicUrl})),N(null)}if(m.email&&m.email!==t.email){let{error:a}=await i.supabase.auth.updateUser({email:m.email});if(a)throw a}if(m.newPassword){if(m.newPassword!==m.confirmPassword)throw Error("Passwords do not match");let{error:a}=await i.supabase.auth.updateUser({password:m.newPassword});if(a)throw a}let{error:e}=await i.supabase.from("profiles").upsert({id:t.id,display_name:m.displayName.trim()||n.display_name,avatar_url:a});if(e)throw e;if(a){let{error:e}=await i.supabase.auth.updateUser({data:{avatar_url:a}});if(e)throw e}await R(t),p(!1),_("Profile updated"),u(a=>({...a,newPassword:"",confirmPassword:""}))}catch(a){v(a.message||"Unable to update profile")}finally{y(!1)}}},L=P||n?.avatar_url||t.user_metadata?.avatar_url,E=n?.display_name?.charAt(0)?.toUpperCase()||t.email?.charAt(0)?.toUpperCase()||"?";return(0,e.jsx)("div",{className:"profile",children:(0,e.jsxs)("div",{className:"profile__card",children:[(0,e.jsxs)("div",{className:"profile__header",children:[(0,e.jsx)("div",{className:"profile__avatar",children:L?(0,e.jsx)("img",{src:L,alt:"User avatar"}):(0,e.jsx)("span",{children:E})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"profile__title",children:"Profile"}),(0,e.jsx)("p",{className:"profile__subtitle",children:"Account details"})]}),(0,e.jsx)("button",{type:"button",className:"profile__edit",onClick:()=>p(!0),"aria-label":"Edit profile",children:(0,e.jsx)(r.Pencil,{size:18})})]}),c?(0,e.jsxs)("form",{className:"profile__form",onSubmit:F,children:[(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"displayName",children:"Display name"}),(0,e.jsx)("input",{id:"displayName",type:"text",value:m.displayName,onChange:a=>u({...m,displayName:a.target.value}),required:!0})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{children:"Avatar source"}),(0,e.jsxs)("div",{className:"profile__switch",children:[(0,e.jsx)("button",{type:"button",className:"url"===g?"is-active":"",onClick:()=>U("url"),children:"URL"}),(0,e.jsx)("button",{type:"button",className:"upload"===g?"is-active":"",onClick:()=>U("upload"),children:"Upload"})]})]}),"url"===g?(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarUrl",children:"Avatar URL"}),(0,e.jsx)("input",{id:"avatarUrl",type:"url",value:m.avatarUrl,onChange:a=>u({...m,avatarUrl:a.target.value}),placeholder:"https://"})]}):(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarFile",children:"Upload avatar"}),(0,e.jsxs)("div",{className:"profile__upload",children:[(0,e.jsx)("input",{id:"avatarFile",type:"file",accept:"image/*",onChange:a=>N(a.target.files?.[0]??null)}),(0,e.jsx)("label",{htmlFor:"avatarFile",className:"profile__file-button",children:"Choose image"}),(0,e.jsx)("span",{className:"profile__file-name",children:x?.name||"No file selected"})]}),(0,e.jsx)("p",{className:"profile__upload-note",children:"The file will be uploaded when you save changes."})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"email",children:"Email"}),(0,e.jsx)("input",{id:"email",type:"email",value:m.email,onChange:a=>u({...m,email:a.target.value})})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"newPassword",children:"New password"}),(0,e.jsx)("input",{id:"newPassword",type:"password",value:m.newPassword,onChange:a=>u({...m,newPassword:a.target.value}),autoComplete:"new-password"})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm password"}),(0,e.jsx)("input",{id:"confirmPassword",type:"password",value:m.confirmPassword,onChange:a=>u({...m,confirmPassword:a.target.value}),autoComplete:"new-password"})]}),f&&(0,e.jsx)("p",{className:"profile__message",children:f}),h&&(0,e.jsx)("p",{className:"profile__error",children:h}),(0,e.jsxs)("div",{className:"profile__actions",children:[(0,e.jsx)("button",{type:"submit",className:"profile__save",children:b?"Saving...":"Save changes"}),(0,e.jsx)("button",{type:"button",className:"profile__cancel",onClick:()=>{t&&n&&(p(!1),_(""),v(""),N(null),U("url"),u({displayName:n.display_name,avatarUrl:n.avatar_url||"",email:t.email||"",newPassword:"",confirmPassword:""}))},children:"Cancel"})]})]}):(0,e.jsxs)("div",{className:"profile__info",children:[(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Display name"}),(0,e.jsx)("span",{className:"profile__value",children:n?.display_name||"-"})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Email"}),(0,e.jsx)("span",{className:"profile__value",children:t.email})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Games played"}),(0,e.jsx)("span",{className:"profile__value",children:n?.games_played??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Wins"}),(0,e.jsx)("span",{className:"profile__value",children:n?.wins??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"User ID"}),(0,e.jsx)("span",{className:"profile__value",children:t.id})]})]})]})})}a.s(["default",()=>t])}]);