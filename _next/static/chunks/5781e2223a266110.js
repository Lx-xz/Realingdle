(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35174,a=>{"use strict";var e=a.i(43476);let l=(0,a.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);function r({label:a="Loading...",compact:r=!1,light:s=!1}){return(0,e.jsxs)("div",{className:`loading ${r?"loading--compact":""} ${s?"loading--light":""}`.trim(),role:"status","aria-live":"polite",children:[(0,e.jsx)(l,{className:"loading__icon"}),a?(0,e.jsx)("span",{className:"loading__label",children:a}):null]})}a.s(["default",()=>r],35174)},97936,a=>{"use strict";var e=a.i(43476);function l({children:a,onClick:l,type:r="button",variant:s="primary",disabled:i=!1}){return(0,e.jsx)("button",{className:`button button--${s}`,onClick:l,type:r,disabled:i,children:a})}a.s(["default",()=>l])},88699,a=>{"use strict";let e=(0,a.i(75254).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.s(["Pencil",()=>e],88699)},2153,a=>{"use strict";var e=a.i(43476),l=a.i(71645),r=a.i(18566),s=a.i(88699),i=a.i(9915),t=a.i(17927),o=a.i(35174),n=a.i(97936);let d=async(a,e,l)=>{let r;try{return await Promise.race([Promise.resolve(a),new Promise((a,s)=>{r=setTimeout(()=>{s(Error(`${l} timed out`))},e)})])}finally{r&&clearTimeout(r)}},c=a=>new Promise(e=>{setTimeout(e,a)}),p=async(a,e,l)=>{let r;for(let l=0;l<e;l+=1)try{return await a()}catch(a){r=a,l<e-1&&await c(350*2**l)}throw Error(`${l} failed after ${e} attempts: ${r instanceof Error?r.message:String(r)}`)};function u(){let a=(0,r.useRouter)(),{user:c,isLoading:u}=(0,i.useAuthSession)(),[m,f]=(0,l.useState)(null),[h,_]=(0,l.useState)(null),[v,w]=(0,l.useState)(!1),[j,x]=(0,l.useState)({displayName:"",avatarUrl:"",email:"",newPassword:"",confirmPassword:""}),[N,y]=(0,l.useState)(""),[b,g]=(0,l.useState)(""),[P,U]=(0,l.useState)(!0),[C,S]=(0,l.useState)(""),[k,E]=(0,l.useState)(null),[L,R]=(0,l.useState)(!1),[$,F]=(0,l.useState)("url"),[T,A]=(0,l.useState)(""),D=a=>a?a.includes("/storage/v1/object/avatars/")?a.replace("/storage/v1/object/avatars/","/storage/v1/object/public/avatars/"):a:null,O=async a=>{let{data:e,error:l}=await p(()=>d(t.supabase.from("profiles").select("id, display_name, avatar_url, games_played, wins").eq("id",a.id).maybeSingle(),5500,"Profile fetch"),1,"Profile fetch");if(l)return void console.error("Error loading profile",l);if(!e){let e=`Guest-${a.id.slice(0,6)}`,{data:l,error:r}=await p(()=>d(t.supabase.from("profiles").insert({id:a.id,display_name:e,avatar_url:a.user_metadata?.avatar_url??null,games_played:0,wins:0}).select("id, display_name, avatar_url, games_played, wins").single(),5500,"Profile create"),1,"Profile create");return r?void console.error("Error creating profile",r):(_(l),void x({displayName:l.display_name,avatarUrl:l.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""}))}_(e),x({displayName:e.display_name,avatarUrl:e.avatar_url||"",email:a.email||"",newPassword:"",confirmPassword:""})};if((0,l.useEffect)(()=>{u||(c?(async()=>{U(!0),S("");try{f(c),await O(c)}catch(a){console.error("Error loading profile page:",a),S("Unable to load profile right now. Please try again.")}finally{U(!1)}})():a.replace("/auth?next=/profile"))},[a,c,u]),(0,l.useEffect)(()=>{if(!v)return void A("");let a=null;return"upload"===$&&k?A(a=URL.createObjectURL(k)):"url"===$&&j.avatarUrl.trim()?A(j.avatarUrl.trim()):A(""),()=>{a&&URL.revokeObjectURL(a)}},[k,$,j.avatarUrl,v]),P)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:(0,e.jsx)(o.default,{label:"Loading profile..."})})});if(C)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsxs)("div",{className:"profile__card",children:[(0,e.jsx)("p",{children:C}),(0,e.jsx)(n.default,{type:"button",onClick:()=>window.location.reload(),children:"Try again"})]})});if(!m)return(0,e.jsx)("div",{className:"profile",children:(0,e.jsx)("div",{className:"profile__card",children:"Redirecting to login..."})});let q=async a=>{if(a.preventDefault(),m&&h){y(""),g(""),R(!1);try{let a="url"===$?D(j.avatarUrl.trim()):null;if("upload"===$&&k){R(!0);let e=k.name.split(".").pop(),l=e?e.toLowerCase():"png",r=`${m.id}/${Date.now()}-avatar.${l}`,{error:s}=await t.supabase.storage.from("avatars").upload(r,k,{upsert:!0});if(s)throw s;let{data:i}=t.supabase.storage.from("avatars").getPublicUrl(r);if(!i?.publicUrl)throw Error("Unable to get avatar URL");a=D(i.publicUrl),x(e=>({...e,avatarUrl:a||i.publicUrl})),E(null)}if(j.email&&j.email!==m.email){let{error:a}=await t.supabase.auth.updateUser({email:j.email});if(a)throw a}if(j.newPassword){if(j.newPassword!==j.confirmPassword)throw Error("Passwords do not match");let{error:a}=await t.supabase.auth.updateUser({password:j.newPassword});if(a)throw a}let{error:e}=await t.supabase.from("profiles").upsert({id:m.id,display_name:j.displayName.trim()||h.display_name,avatar_url:a});if(e)throw e;if(a){let{error:e}=await t.supabase.auth.updateUser({data:{avatar_url:a}});if(e)throw e}await O(m),w(!1),y("Profile updated"),x(a=>({...a,newPassword:"",confirmPassword:""}))}catch(a){g(a.message||"Unable to update profile")}finally{R(!1)}}},z=T||h?.avatar_url||m.user_metadata?.avatar_url,B=h?.display_name?.charAt(0)?.toUpperCase()||m.email?.charAt(0)?.toUpperCase()||"?";return(0,e.jsx)("div",{className:"profile",children:(0,e.jsxs)("div",{className:"profile__card",children:[(0,e.jsxs)("div",{className:"profile__header",children:[(0,e.jsx)("div",{className:"profile__avatar",children:z?(0,e.jsx)("img",{src:z,alt:"User avatar"}):(0,e.jsx)("span",{children:B})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"profile__title",children:"Profile"}),(0,e.jsx)("p",{className:"profile__subtitle",children:"Account details"})]}),(0,e.jsx)("button",{type:"button",className:"profile__edit",onClick:()=>w(!0),"aria-label":"Edit profile",children:(0,e.jsx)(s.Pencil,{size:18})})]}),v?(0,e.jsxs)("form",{className:"profile__form",onSubmit:q,children:[(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"displayName",children:"Display name"}),(0,e.jsx)("input",{id:"displayName",type:"text",value:j.displayName,onChange:a=>x({...j,displayName:a.target.value}),required:!0})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{children:"Avatar source"}),(0,e.jsxs)("div",{className:"profile__switch",children:[(0,e.jsx)("button",{type:"button",className:"url"===$?"is-active":"",onClick:()=>F("url"),children:"URL"}),(0,e.jsx)("button",{type:"button",className:"upload"===$?"is-active":"",onClick:()=>F("upload"),children:"Upload"})]})]}),"url"===$?(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarUrl",children:"Avatar URL"}),(0,e.jsx)("input",{id:"avatarUrl",type:"url",value:j.avatarUrl,onChange:a=>x({...j,avatarUrl:a.target.value}),placeholder:"https://"})]}):(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"avatarFile",children:"Upload avatar"}),(0,e.jsxs)("div",{className:"profile__upload",children:[(0,e.jsx)("input",{id:"avatarFile",type:"file",accept:"image/*",onChange:a=>E(a.target.files?.[0]??null)}),(0,e.jsx)("label",{htmlFor:"avatarFile",className:"profile__file-button",children:"Choose image"}),(0,e.jsx)("span",{className:"profile__file-name",children:k?.name||"No file selected"})]}),(0,e.jsx)("p",{className:"profile__upload-note",children:"The file will be uploaded when you save changes."})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"email",children:"Email"}),(0,e.jsx)("input",{id:"email",type:"email",value:j.email,onChange:a=>x({...j,email:a.target.value})})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"newPassword",children:"New password"}),(0,e.jsx)("input",{id:"newPassword",type:"password",value:j.newPassword,onChange:a=>x({...j,newPassword:a.target.value}),autoComplete:"new-password"})]}),(0,e.jsxs)("div",{className:"profile__field",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm password"}),(0,e.jsx)("input",{id:"confirmPassword",type:"password",value:j.confirmPassword,onChange:a=>x({...j,confirmPassword:a.target.value}),autoComplete:"new-password"})]}),N&&(0,e.jsx)("p",{className:"profile__message",children:N}),b&&(0,e.jsx)("p",{className:"profile__error",children:b}),(0,e.jsxs)("div",{className:"profile__actions",children:[(0,e.jsx)("button",{type:"submit",className:"profile__save",children:L?"Saving...":"Save changes"}),(0,e.jsx)("button",{type:"button",className:"profile__cancel",onClick:()=>{m&&h&&(w(!1),y(""),g(""),E(null),F("url"),x({displayName:h.display_name,avatarUrl:h.avatar_url||"",email:m.email||"",newPassword:"",confirmPassword:""}))},children:"Cancel"})]})]}):(0,e.jsxs)("div",{className:"profile__info",children:[(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Display name"}),(0,e.jsx)("span",{className:"profile__value",children:h?.display_name||"-"})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Email"}),(0,e.jsx)("span",{className:"profile__value",children:m.email})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Games played"}),(0,e.jsx)("span",{className:"profile__value",children:h?.games_played??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"Wins"}),(0,e.jsx)("span",{className:"profile__value",children:h?.wins??0})]}),(0,e.jsxs)("div",{className:"profile__row",children:[(0,e.jsx)("span",{className:"profile__label",children:"User ID"}),(0,e.jsx)("span",{className:"profile__value",children:m.id})]})]})]})})}a.s(["default",()=>u])}]);