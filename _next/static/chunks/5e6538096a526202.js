(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35174,e=>{"use strict";var a=e.i(43476);let s=(0,e.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);function r({label:e="Loading...",compact:r=!1,light:t=!1}){return(0,a.jsxs)("div",{className:`loading ${r?"loading--compact":""} ${t?"loading--light":""}`.trim(),role:"status","aria-live":"polite",children:[(0,a.jsx)(s,{className:"loading__icon"}),e?(0,a.jsx)("span",{className:"loading__label",children:e}):null]})}e.s(["default",()=>r],35174)},97936,e=>{"use strict";var a=e.i(43476);function s({children:e,onClick:s,type:r="button",variant:t="primary",disabled:c=!1}){return(0,a.jsx)("button",{className:`button button--${t}`,onClick:s,type:r,disabled:c,children:e})}e.s(["default",()=>s])},43531,1892,e=>{"use strict";let a=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>a],43531);var s=e.i(17927);let r=`
  id,
  name,
  description,
  image_url,
  age,
  created_at,
  updated_at,
  state:states(id, name),
  classes:character_classes(class:classes(id, name)),
  races:character_races(race:races(id, name)),
  occupations:character_occupations(occupation:occupations(id, name)),
  associations:character_associations(association:associations(id, name)),
  places:character_places(place:places(id, name))
`,t=e=>({id:e.id,name:e.name,description:e.description,image_url:e.image_url,age:e.age,created_at:e.created_at,updated_at:e.updated_at,state:Array.isArray(e.state)?e.state[0]:e.state,classes:e.classes?.map(e=>e.class)??[],races:e.races?.map(e=>e.race)??[],occupations:e.occupations?.map(e=>e.occupation)??[],associations:e.associations?.map(e=>e.association)??[],places:e.places?.map(e=>e.place)??[]}),c=async(e={})=>{let{data:a,error:c}=await s.supabase.from("characters").select(r).order("name",{ascending:e.ascending??!0});if(c)throw c;return a.map(t)};e.s(["fetchCharacters",0,c],1892)},8134,e=>{"use strict";var a=e.i(43476),s=e.i(71645),r=e.i(18566),t=e.i(75254);let c=(0,t.default)("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),i=(0,t.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var l=e.i(43531);let n=(0,t.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),d=(0,t.default)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),o=(0,t.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),m=(0,t.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var u=e.i(9915),h=e.i(4048);function g({value:e,onChange:r,onSubmit:t,suggestions:c=[],onSelectSuggestion:i,noResultsText:l="No results",placeholder:n="Search character...",disabled:d=!1}){let o=(0,s.useRef)(null),[m,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=e=>{o.current&&(o.current.contains(e.target)||u(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let g=m&&e.trim().length>0,_=c.length>0;return(0,a.jsx)("form",{className:"search-bar",onSubmit:a=>{a.preventDefault(),e.trim()&&(t(e.trim()),u(!1))},children:(0,a.jsxs)("div",{className:"search-bar__field",ref:o,children:[(0,a.jsx)("input",{type:"text",className:"search-bar__input",value:e,onChange:e=>{r(e.target.value),u(!0)},onFocus:()=>u(!0),placeholder:n,disabled:d}),g&&(0,a.jsx)("div",{className:"search-bar__dropdown",children:(0,a.jsx)("div",{className:"search-bar__dropdown-content",children:_?(0,a.jsx)(h.default,{className:"search-bar__scroll",children:(0,a.jsx)("ul",{className:"search-bar__list",children:c.map(e=>(0,a.jsx)("li",{className:"search-bar__item",children:(0,a.jsxs)("button",{type:"button",onMouseDown:a=>{var s;a.preventDefault(),s=e.name,i?.(s),t(s),u(!1)},className:"search-bar__option",children:[e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"search-bar__avatar"}):(0,a.jsx)("span",{className:"search-bar__avatar search-bar__avatar--placeholder",children:e.name.charAt(0)}),(0,a.jsx)("span",{className:"search-bar__option-text",children:e.name})]})},e.name))})}):(0,a.jsx)("div",{className:"search-bar__empty",children:l})})})]})})}function _({lives:e,maxLives:s=10}){let r=Math.max(0,Math.min(100,e/s*100));return(0,a.jsx)("div",{className:"life-bar__track",children:(0,a.jsxs)("div",{className:"life-bar__fill",style:{width:`${r}%`},children:[e,"/",s]})})}var p=e.i(97936),f=e.i(35174),w=e.i(1892),x=e.i(17927);let v=async e=>{let{data:a}=await x.supabase.from("profiles").select("games_played").eq("id",e).single();if(!a)return;let{error:s}=await x.supabase.from("profiles").update({games_played:(a.games_played||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing games_played:",s),s},y=async e=>{let{data:a}=await x.supabase.from("profiles").select("wins").eq("id",e).single();if(!a)return;let{error:s}=await x.supabase.from("profiles").update({wins:(a.wins||0)+1}).eq("id",e);if(s)throw console.error("Error incrementing wins:",s),s},j=async(e,a,s)=>{let r;try{return await Promise.race([Promise.resolve(e),new Promise((e,t)=>{r=setTimeout(()=>{t(Error(`${s} timed out`))},a)})])}finally{r&&clearTimeout(r)}},N=e=>new Promise(a=>{setTimeout(a,e)}),b=async(e,a,s)=>{let r;for(let s=0;s<a;s+=1)try{return await e()}catch(e){r=e,s<a-1&&await N(400*2**s)}throw Error(`${s} failed after ${a} attempts: ${r instanceof Error?r.message:String(r)}`)};function k(){return(0,a.jsx)(S,{})}function S({forcedDate:e}){let t=(0,r.useRouter)(),{user:h}=(0,u.useAuthSession)(),[N,k]=(0,s.useState)(""),[S,C]=(0,s.useState)(10),[$,M]=(0,s.useState)([]),[A,E]=(0,s.useState)(!1),[q,I]=(0,s.useState)(!1),[L,D]=(0,s.useState)(!1),[O,P]=(0,s.useState)(null),[T,R]=(0,s.useState)([]),[F,J]=(0,s.useState)(!0),[K,U]=(0,s.useState)(""),[z,B]=(0,s.useState)(!1),[G,V]=(0,s.useState)([]),[H,Y]=(0,s.useState)(!1),[Q,W]=(0,s.useState)(!1),[X,Z]=(0,s.useState)(!1),[ee,ea]=(0,s.useState)({}),es=(0,s.useRef)(null),er=(0,s.useRef)(0),et=()=>new Date().toISOString().slice(0,10),ec=(0,s.useMemo)(()=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e)?e:et(),[e]),ei=h?.id??null,el=ec===et(),en=`realingdle:game-state:v3:${ec}`;(0,s.useEffect)(()=>{eo()},[ec]);let ed=async()=>{if(X)return;Z(!0);let{data:e,error:a}=await b(()=>j(x.supabase.from("daily_characters").select("date").order("date",{ascending:!1}),1e4,"Available dates fetch"),2,"Available dates fetch");if(a){console.error("Error loading available game dates:",a),Z(!1);return}V((e??[]).map(e=>e.date).filter(e=>"string"==typeof e));let s=h?.id;if(!s){ea({}),W(!0),Z(!1);return}let{data:r,error:t}=await b(()=>j(x.supabase.from("daily_game_attempts").select("game_date, won, found, lives_remaining").eq("user_id",s),1e4,"Date statuses fetch"),2,"Date statuses fetch");if(t){console.error("Error loading date statuses:",t),ea({}),W(!0),Z(!1);return}let c={};(r??[]).forEach(e=>{let a=e.game_date;"string"==typeof a&&(e.won||e.found?c[a]="won":(e.lives_remaining??0)<=0?c[a]="lost":c[a]="in-progress")}),ea(c),W(!0),Z(!1)};(0,s.useEffect)(()=>{Q||X||ed()},[h?.id]);let eo=async()=>{if(es.current)return es.current;let e=(async()=>{let e=++er.current,a="realingdle:characters-cache:v1";B(!1),U("");let s=!1;try{let e=window.localStorage.getItem(a),r=window.localStorage.getItem(en);if(e&&r){let a=JSON.parse(e),t=JSON.parse(r);if(Array.isArray(a.data)&&"number"==typeof a.expiresAt&&a.expiresAt>Date.now()&&t.dateKey===ec){let e=a.data,r=e.find(e=>e.id===t.characterId);if(r){R(e),P(r),M(Array.isArray(t.guesses)?t.guesses:[]);let a=Math.max(0,Math.min(t.lives??10,10)),c=!!t.won,i=!!(t.found??t.won);C(a),I(c),D(i),E(i||0===a),s=!0}}}}catch{window.localStorage.removeItem(a),window.localStorage.removeItem(en)}s?J(!1):(M([]),C(10),I(!1),D(!1),E(!1),J(!0));try{let s=await b(()=>j((0,w.fetchCharacters)({ascending:!0}),15e3,"Characters fetch"),3,"Characters fetch");if(e!==er.current)return;R(s),window.localStorage.setItem(a,JSON.stringify({data:s,expiresAt:Date.now()+3e5}));let r=h?.id??null,{data:t,error:c}=await b(()=>j(x.supabase.from("daily_characters").select("character_id").eq("date",ec).maybeSingle(),12e3,"Daily character fetch"),3,"Daily character fetch");if(c)throw c;let i=s.find(e=>e.id===t?.character_id);if(!i)throw Error("Daily character not found");if(e!==er.current)return;if(P(i),r){let{data:a,error:s}=await b(()=>j(x.supabase.from("daily_game_attempts").select("guesses, lives_remaining, won, found").eq("user_id",r).eq("game_date",ec).maybeSingle(),12e3,"Saved attempt fetch"),2,"Saved attempt fetch");if(s&&console.error("Error loading saved attempt:",s),a){let s=Array.isArray(a.guesses)?a.guesses.filter(e=>"string"==typeof e):[];if(e!==er.current)return;M(s);let r=Math.max(0,Math.min(a.lives_remaining??10,10)),t=!!a.won,c=!!(a.found||a.won);C(r),I(t),D(c),E(c||0===r),B(!0);return}}{let e=window.localStorage.getItem(en);if(e)try{let a=JSON.parse(e);if(a.dateKey===ec&&a.characterId===i.id){M(a.guesses);let e=Math.max(0,Math.min(a.lives,10)),s=!!a.won,r=!!(a.found??a.won);C(e),I(s),D(r),E(r||0===e)}else window.localStorage.removeItem(en)}catch{window.localStorage.removeItem(en)}}}catch(e){console.error("Error fetching character:",e),s||U("Unable to load game right now. Please try again.")}finally{e===er.current&&(B(!0),J(!1))}})().finally(()=>{es.current===e&&(es.current=null)});return es.current=e,e},em=async e=>{let{data:a,error:s}=await x.supabase.rpc("daily_guess",{guess_character_id:e,game_date:ec});if(s)throw s;return a&&"object"==typeof a&&"boolean"==typeof a.is_correct?a.is_correct:null},eu=async()=>{let{data:e,error:a}=await x.supabase.rpc("daily_character_reveal",{game_date:ec});if(a)throw a;let s=T.find(a=>a.id===e);s&&P(s)};(0,s.useEffect)(()=>{if(!O)return;let e={dateKey:ec,characterId:O.id,guesses:$,lives:S,won:q,found:L};window.localStorage.setItem(en,JSON.stringify(e))},[O,$,S,q,L,ec,en]),(0,s.useEffect)(()=>{O&&z&&ei&&0!==$.length&&(async()=>{let{error:e}=await x.supabase.from("daily_game_attempts").upsert({user_id:ei,game_date:ec,lives_remaining:S,guesses:$,won:q,found:L},{onConflict:"user_id,game_date"});e&&console.error("Error saving daily attempt:",e)})()},[O,$,S,q,L,ei,z,ec]);let eh=async e=>{if(A||!O)return;let a=T.find(a=>a.name.toLowerCase()===e.toLowerCase());if(!a)return void k("");let s=[...$,a.id];if(0===$.length&&el&&ei)try{await v(ei)}catch(e){console.error("Failed to increment games_played:",e)}M(s);let r=null;try{r=await em(a.id)}catch(e){console.error("Failed to validate guess on backend:",e)}if(r??a.name.toLowerCase()===O.name.toLowerCase()){if(D(!0),I(el),E(!0),el&&ei)try{await y(ei)}catch(e){console.error("Failed to increment wins:",e)}}else{let e=S-1;if(C(e),0===e){E(!0);try{await eu()}catch(e){console.error("Failed to reveal character on defeat:",e)}}}k("")},eg=e=>T.find(a=>a.id===e)||null,e_=new Set($.map(e=>eg(e)?.id).filter(e=>!!e)),ep=N.trim().length?T.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())).filter(e=>!e_.has(e.id)).map(e=>({name:e.name,image_url:e.image_url})):[],ef=(e,s,r="None")=>{let t=new Set(s.map(e=>e.id));return 0===e.length?(0,a.jsx)("span",{className:"guess-chip guess-chip--miss",children:r}):e.map(e=>(0,a.jsx)("span",{className:`guess-chip ${t.has(e.id)?"guess-chip--match":"guess-chip--miss"}`,children:e.name},e.id))};return F?(0,a.jsx)("div",{className:"game",children:(0,a.jsx)("div",{className:"game__container",children:(0,a.jsx)(f.default,{label:"Loading..."})})}):K?(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("h2",{children:"Loading failed"}),(0,a.jsx)("p",{children:K}),(0,a.jsx)(p.default,{onClick:eo,children:"Try again"})]})}):O?(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("div",{className:"game__header",children:(0,a.jsxs)("div",{className:"game__date-dropdown-wrap",children:[(0,a.jsxs)("button",{type:"button",className:"game__date-trigger",onClick:()=>{Y(e=>!e),H||Q||ed()},children:[(0,a.jsx)(c,{className:"game__date-trigger-icon"}),(0,a.jsx)("span",{children:(e=>{let[a,s,r]=e.split("-");return a&&s&&r?`${r}/${s}/${a}`:e})(ec)}),(0,a.jsx)(i,{className:`game__date-trigger-chevron ${H?"game__date-trigger-chevron--open":""}`})]}),H&&(0,a.jsxs)("div",{className:"game__date-dropdown",children:[X&&(0,a.jsx)("div",{className:"game__date-loading",children:(0,a.jsx)(f.default,{label:"Carregando datas...",compact:!0,light:!0})}),(0,a.jsx)("div",{className:"game__date-grid",children:G.map(e=>{let s=ee[e],r=e===ec?"game__date-chip--selected":"",c=null;return"won"===s?c=l.Check:"lost"===s?c=n:"in-progress"===s&&(c=d),(0,a.jsxs)("button",{type:"button",className:`game__date-chip ${"won"===s?"game__date-chip--won":"lost"===s?"game__date-chip--lost":"in-progress"===s?"game__date-chip--in-progress":""} ${r}`,onClick:()=>(e=>{if(e===et()){t.push("/game"),Y(!1);return}t.push(`/game/${e}`),Y(!1)})(e),children:[c&&(0,a.jsx)(c,{size:16,style:{marginRight:4,verticalAlign:"middle"}}),(e=>{let[,a,s]=e.split("-");return a&&s?`${s}/${a}`:e})(e)]},e)})})]})]})}),(0,a.jsx)(_,{lives:S,maxLives:10}),!A&&(0,a.jsx)("div",{className:"game__search",children:(0,a.jsx)(g,{value:N,onChange:k,onSubmit:eh,suggestions:ep,onSelectSuggestion:e=>k(e),noResultsText:"No characters found",disabled:A})}),A&&(0,a.jsxs)("div",{className:`game__result ${L?"game__result--win":"game__result--lose"}`,children:[(0,a.jsx)("h2",{children:L?"ðŸŽ‰ Congratulations!":"ðŸ˜¢ Game Over"}),(0,a.jsx)("p",{children:L?`You guessed the character "${O.name}" correctly!`:`The character was "${O.name}"`})]}),(0,a.jsx)("div",{className:"game__guesses",children:(0,a.jsx)("ul",{className:"game__guesses-list",children:[...$].reverse().map((e,s)=>{let r=eg(e),t=r?.id===O?.id;if(!r||!O)return(0,a.jsxs)("li",{className:"game__guess-card game__guess-card--unknown",children:[(0,a.jsxs)("div",{className:"game__guess-header",children:[(0,a.jsx)("span",{className:"game__guess-name",children:"Unknown character"}),(0,a.jsx)("span",{className:"game__guess-status",children:"Unknown"})]}),(0,a.jsx)("p",{className:"game__guess-missing",children:"Character not found."})]},s);let c={state:r.state?.id===O.state?.id,age:(r.age??null)===(O.age??null),ageComparison:null==O.age?"no-age":r.age===O.age?"equal":null!=r.age&&r.age>O.age?"down":null!=r.age&&r.age<O.age?"up":"no-age"},i=r.image_url?{"--guess-image":`url(${r.image_url})`}:void 0;return(0,a.jsx)("li",{className:`game__guess-card ${t?"game__guess-card--correct":"game__guess-card--wrong"}`,children:(0,a.jsxs)("div",{className:"guess-card__content",children:[(0,a.jsxs)("div",{className:"guess-card__info",children:[(0,a.jsxs)("div",{className:"guess-card__title",children:[(0,a.jsx)("h4",{children:r.name}),r.description&&(0,a.jsxs)("p",{className:"guess-card__quote",children:["â€œ",r.description,"â€"]})]}),(0,a.jsxs)("div",{className:"guess-card__row-group",children:[(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Age"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${null==O.age?"guess-chip--no-age":c.age?"guess-chip--match":"guess-chip--miss"}`,children:null==r.age?"?":(0,a.jsx)(a.Fragment,{children:null!=O.age&&null!=r.age&&(0,a.jsxs)(a.Fragment,{children:["up"===c.ageComparison&&(0,a.jsx)(o,{className:"guess-chip__icon",size:14}),"down"===c.ageComparison&&(0,a.jsx)(m,{className:"guess-chip__icon",size:14}),r.age]})})})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"State"}),(0,a.jsx)("div",{className:"guess-card__chips",children:(0,a.jsx)("span",{className:`guess-chip ${c.state?"guess-chip--match":"guess-chip--miss"}`,children:r.state?.name||"-"})})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Classes"}),(0,a.jsx)("div",{className:"guess-card__chips",children:ef(r.classes,O.classes)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--compact",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Races"}),(0,a.jsx)("div",{className:"guess-card__chips",children:ef(r.races,O.races)})]})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Occupations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:ef(r.occupations,O.occupations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Associations"}),(0,a.jsx)("div",{className:"guess-card__chips",children:ef(r.associations,O.associations)})]}),(0,a.jsxs)("div",{className:"guess-card__row guess-card__row--stacked",children:[(0,a.jsx)("span",{className:"guess-card__label",children:"Places"}),(0,a.jsx)("div",{className:"guess-card__chips",children:ef(r.places,O.places)})]})]}),(0,a.jsx)("div",{className:"guess-card__image",style:i})]})},s)})})})]})}):(0,a.jsx)("div",{className:"game",children:(0,a.jsxs)("div",{className:"game__container",children:[(0,a.jsx)("h2",{children:"No characters available"}),(0,a.jsx)("p",{children:"Please contact the administrator to add characters."}),(0,a.jsx)(p.default,{onClick:()=>t.push("/"),children:"Back to Home"})]})})}e.s(["GamePageContent",()=>S,"default",()=>k],8134)}]);