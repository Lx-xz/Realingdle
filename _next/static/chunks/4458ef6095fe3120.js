(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82929,e=>{"use strict";var a=e.i(43476),s=e.i(71645),i=e.i(18566),r=e.i(48978);let t={name:"",description:"",image_url:"",image_file:null,age:"",state_id:"",class_ids:[],race_ids:[],occupation_ids:[],association_ids:[],place_ids:[]};function c({characters:e,states:i,classes:c,races:l,occupations:n,associations:d,places:o,onAdd:u,onEdit:h,onDelete:m}){let[_,p]=(0,s.useState)(!1),[f,g]=(0,s.useState)(null),[x,j]=(0,s.useState)(t),[b,v]=(0,s.useState)(null),[N,y]=(0,s.useState)("url"),[w,C]=(0,s.useState)(""),S="https://placehold.co/200x400?text=",k=(e,a)=>{j(s=>{let i=s[e],r=i.includes(a);return{...s,[e]:r?i.filter(e=>e!==a):[...i,a]}})},A=(0,s.useMemo)(()=>({class_ids:c,race_ids:l,occupation_ids:n,association_ids:d,place_ids:o}),[c,l,n,d,o]);(0,s.useEffect)(()=>{if("url"!==N||x.image_url||j(e=>({...e,image_url:S})),"upload"===N&&x.image_file){let e=URL.createObjectURL(x.image_file);return C(e),()=>{URL.revokeObjectURL(e)}}"url"===N&&x.image_url.trim()?C(x.image_url.trim()):C("")},[N,x.image_file,x.image_url]);let E=({label:e,fieldKey:i,options:r,selectedIds:t,onAdd:c,onRemove:l,single:n=!1})=>{let d=(0,s.useRef)(null),o=b===i,u=r.filter(e=>t.includes(e.id));return(0,s.useEffect)(()=>{if(!o)return;let e=e=>{d.current&&(d.current.contains(e.target)||v(null))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o]),(0,a.jsxs)("div",{className:"attribute-picker",ref:d,children:[(0,a.jsxs)("div",{className:"attribute-picker__header",children:[(0,a.jsx)("span",{className:"attribute-picker__label",children:e}),(0,a.jsx)("button",{type:"button",className:"attribute-picker__add",onClick:()=>v(o?null:i),children:"+"})]}),o&&(0,a.jsx)("div",{className:"attribute-picker__menu",children:r.map(e=>{let s=t.includes(e.id);return(0,a.jsxs)("button",{type:"button",className:`attribute-picker__option ${s?"is-selected":""}`,onClick:()=>{if(n){c(e.id),v(null);return}s?l(e.id):c(e.id)},children:[(0,a.jsx)("span",{children:e.name}),s&&(0,a.jsx)("span",{className:"attribute-picker__check",children:"v"})]},e.id)})}),(0,a.jsx)("div",{className:"attribute-picker__tags",children:0===u.length?(0,a.jsx)("span",{className:"attribute-picker__empty",children:"None"}):u.map(e=>(0,a.jsxs)("span",{className:"attribute-picker__tag",children:[e.name,(0,a.jsx)("button",{type:"button",className:"attribute-picker__remove",onClick:()=>l(e.id),children:"x"})]},e.id))})]})},R=e=>e.length>0?e.map(e=>e.name).join(", "):"-";return(0,a.jsxs)("div",{className:"character-table",children:[(0,a.jsxs)("div",{className:"character-table__header",children:[(0,a.jsx)("h2",{children:"Characters"}),!_&&(0,a.jsx)(r.default,{onClick:()=>p(!0),children:"Add Character"})]}),_&&(0,a.jsxs)("form",{className:"character-form",onSubmit:e=>{e.preventDefault(),f?(h(f,x),g(null)):(u(x),p(!1)),j(t),y("url")},children:[(0,a.jsxs)("div",{className:"character-form__grid",children:[(0,a.jsxs)("div",{className:"character-form__field character-form__field--wide",children:[(0,a.jsx)("label",{children:"Image"}),(0,a.jsxs)("div",{className:"character-form__media",children:[(0,a.jsx)("div",{className:"character-form__media-preview",children:w?(0,a.jsx)("img",{src:w,alt:"Preview"}):(0,a.jsx)("span",{children:"No preview"})}),(0,a.jsxs)("div",{className:"character-form__media-controls",children:[(0,a.jsxs)("div",{className:"character-form__toggle",children:[(0,a.jsx)("button",{type:"button",className:"url"===N?"is-active":"",onClick:()=>{y("url"),j(e=>({...e,image_url:e.image_url||S}))},children:"Use URL"}),(0,a.jsx)("button",{type:"button",className:"upload"===N?"is-active":"",onClick:()=>y("upload"),children:"Upload file"})]}),"url"===N?(0,a.jsx)("input",{id:"image_url",type:"url",value:x.image_url,onChange:e=>j({...x,image_url:e.target.value}),placeholder:S}):(0,a.jsxs)("div",{className:"character-form__file",children:[(0,a.jsx)("input",{id:"image_file",type:"file",accept:"image/*",className:"character-form__file-input",onChange:e=>j({...x,image_file:e.target.files?.[0]??null})}),(0,a.jsx)("label",{htmlFor:"image_file",className:"character-form__file-button",children:"Choose file"}),(0,a.jsx)("span",{className:"character-form__file-name",children:x.image_file?.name||"No file selected"})]})]})]})]}),(0,a.jsxs)("div",{className:"character-form__row character-form__row--two",children:[(0,a.jsxs)("div",{className:"character-form__field",children:[(0,a.jsx)("label",{htmlFor:"name",children:"Name"}),(0,a.jsx)("input",{id:"name",type:"text",value:x.name,onChange:e=>j({...x,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"character-form__field",children:[(0,a.jsx)("label",{htmlFor:"age",children:"Age"}),(0,a.jsx)("input",{id:"age",type:"number",min:0,value:x.age,onChange:e=>j({...x,age:""===e.target.value?"":Number(e.target.value)})})]})]}),(0,a.jsxs)("div",{className:"character-form__attributes",children:[(0,a.jsx)(E,{label:"State",fieldKey:"state_id",options:i,selectedIds:x.state_id?[x.state_id]:[],onAdd:e=>j({...x,state_id:e}),onRemove:()=>j({...x,state_id:""}),single:!0}),(0,a.jsx)(E,{label:"Classes",fieldKey:"class_ids",options:A.class_ids,selectedIds:x.class_ids,onAdd:e=>k("class_ids",e),onRemove:e=>k("class_ids",e)}),(0,a.jsx)(E,{label:"Races",fieldKey:"race_ids",options:A.race_ids,selectedIds:x.race_ids,onAdd:e=>k("race_ids",e),onRemove:e=>k("race_ids",e)}),(0,a.jsx)(E,{label:"Occupations",fieldKey:"occupation_ids",options:A.occupation_ids,selectedIds:x.occupation_ids,onAdd:e=>k("occupation_ids",e),onRemove:e=>k("occupation_ids",e)}),(0,a.jsx)(E,{label:"Associations",fieldKey:"association_ids",options:A.association_ids,selectedIds:x.association_ids,onAdd:e=>k("association_ids",e),onRemove:e=>k("association_ids",e)}),(0,a.jsx)(E,{label:"Places",fieldKey:"place_ids",options:A.place_ids,selectedIds:x.place_ids,onAdd:e=>k("place_ids",e),onRemove:e=>k("place_ids",e)})]})]}),(0,a.jsxs)("div",{className:"character-form__field",children:[(0,a.jsx)("label",{htmlFor:"description",children:"Description"}),(0,a.jsx)("textarea",{id:"description",value:x.description,onChange:e=>j({...x,description:e.target.value}),rows:3})]}),(0,a.jsxs)("div",{className:"character-form__actions",children:[(0,a.jsx)(r.default,{type:"submit",children:f?"Update":"Add"}),(0,a.jsx)(r.default,{variant:"secondary",onClick:()=>{p(!1),g(null),j(t),y("url")},children:"Cancel"})]})]}),(0,a.jsx)("div",{className:"character-table__table-wrapper",children:(0,a.jsxs)("table",{className:"character-table__table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"State"}),(0,a.jsx)("th",{children:"Classes"}),(0,a.jsx)("th",{children:"Races"}),(0,a.jsx)("th",{children:"Occupations"}),(0,a.jsx)("th",{children:"Associations"}),(0,a.jsx)("th",{children:"Places"}),(0,a.jsx)("th",{children:"Age"}),(0,a.jsx)("th",{children:"Description"}),(0,a.jsx)("th",{children:"Image"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:e.state?.name||"-"}),(0,a.jsx)("td",{children:R(e.classes)}),(0,a.jsx)("td",{children:R(e.races)}),(0,a.jsx)("td",{children:R(e.occupations)}),(0,a.jsx)("td",{children:R(e.associations)}),(0,a.jsx)("td",{children:R(e.places)}),(0,a.jsx)("td",{children:e.age??"-"}),(0,a.jsx)("td",{children:e.description||"-"}),(0,a.jsx)("td",{children:e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"character-table__image-preview"}):"-"}),(0,a.jsxs)("td",{className:"character-table__actions",children:[(0,a.jsx)(r.default,{variant:"secondary",onClick:()=>{g(e.id),j({name:e.name,description:e.description||"",image_url:e.image_url||"",image_file:null,age:e.age??"",state_id:e.state?.id||"",class_ids:e.classes.map(e=>e.id),race_ids:e.races.map(e=>e.id),occupation_ids:e.occupations.map(e=>e.id),association_ids:e.associations.map(e=>e.id),place_ids:e.places.map(e=>e.id)}),p(!0),y(e.image_url?"url":"upload")},children:"Edit"}),(0,a.jsx)(r.default,{variant:"danger",onClick:()=>m(e.id),children:"Delete"})]})]},e.id)),0===e.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:11,className:"character-table__empty",children:"No characters found. Add one to get started!"})})]})]})})]})}var l=e.i(17927),n=e.i(1892);function d(){let e=(0,i.useRouter)(),[t,d]=(0,s.useState)(!1),[o,u]=(0,s.useState)(""),[h,m]=(0,s.useState)(""),[_,p]=(0,s.useState)(""),[f,g]=(0,s.useState)([]),[x,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[N,y]=(0,s.useState)([]),[w,C]=(0,s.useState)([]),[S,k]=(0,s.useState)([]),[A,E]=(0,s.useState)([]),[R,P]=(0,s.useState)(!1),[U,L]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{let{data:e}=await l.supabase.auth.getSession();d(!!e.session)})();let{data:e}=l.supabase.auth.onAuthStateChange((e,a)=>{d(!!a)});return()=>{e.subscription.unsubscribe()}},[]),(0,s.useEffect)(()=>{t&&D()},[t]);let I=async e=>{e.preventDefault(),p(""),L(!0);try{let{error:e}=await l.supabase.auth.signInWithPassword({email:o,password:h});if(e)throw e}catch(e){console.error("Error verifying user:",e),p("Unable to login. Please try again.")}finally{L(!1)}},K=async()=>{await l.supabase.auth.signOut(),d(!1),u(""),m(""),g([]),p("")},D=async()=>{P(!0),p("");try{await Promise.all([O(),q()])}catch(e){console.error("Error loading configs data:",e),p("Unable to load data. Please check your Supabase configuration.")}finally{P(!1)}},O=async()=>{g(await (0,n.fetchCharacters)({ascending:!1}))},q=async()=>{let[e,a,s,i,r,t]=await Promise.all([l.supabase.from("states").select("*").order("name",{ascending:!0}),l.supabase.from("classes").select("*").order("name",{ascending:!0}),l.supabase.from("races").select("*").order("name",{ascending:!0}),l.supabase.from("occupations").select("*").order("name",{ascending:!0}),l.supabase.from("associations").select("*").order("name",{ascending:!0}),l.supabase.from("places").select("*").order("name",{ascending:!0})]),c=[e,a,s,i,r,t],n=c.find(e=>e.error)?.error;if(n)throw n;j(e.data||[]),v(a.data||[]),y(s.data||[]),C(i.data||[]),k(r.data||[]),E(t.data||[])},F=(e,a)=>({name:e.name.trim(),description:e.description.trim()||null,image_url:a??(e.image_url.trim()||null),age:""===e.age?null:e.age,state_id:e.state_id||null}),T=async e=>{let a="characters_images",s=e.name.replace(/[^a-zA-Z0-9.-]/g,"-"),i=`characters/${Date.now()}-${s}`,{error:r}=await l.supabase.storage.from(a).upload(i,e,{upsert:!0});if(r)throw r;let{data:t}=l.supabase.storage.from(a).getPublicUrl(i);return t.publicUrl},B=async e=>e.image_file?T(e.image_file):null,$=async(e,a,s,i)=>{let{error:r}=await l.supabase.from(e).delete().eq("character_id",s);if(r)throw r;if(0===i.length)return;let t=i.map(e=>({character_id:s,[a]:e})),{error:c}=await l.supabase.from(e).insert(t);if(c)throw c},M=async(e,a)=>{await Promise.all([$("character_classes","class_id",e,a.class_ids),$("character_races","race_id",e,a.race_ids),$("character_occupations","occupation_id",e,a.occupation_ids),$("character_associations","association_id",e,a.association_ids),$("character_places","place_id",e,a.place_ids)])},z=async e=>{try{let a=await B(e),{data:s,error:i}=await l.supabase.from("characters").insert([F(e,a)]).select("id").single();if(i)throw i;await M(s.id,e),await O()}catch(e){console.error("Error adding character:",e),alert("Error adding character. Please check your Supabase configuration.")}},H=async(e,a)=>{try{let s=await B(a),{error:i}=await l.supabase.from("characters").update(F(a,s)).eq("id",e);if(i)throw i;await M(e,a),await O()}catch(e){console.error("Error updating character:",e),alert("Error updating character. Please check your Supabase configuration.")}},W=async e=>{if(confirm("Are you sure you want to delete this character?"))try{let{error:a}=await l.supabase.from("characters").delete().eq("id",e);if(a)throw a;await O()}catch(e){console.error("Error deleting character:",e),alert("Error deleting character. Please check your Supabase configuration.")}};return t?(0,a.jsx)("div",{className:"configs",children:(0,a.jsxs)("div",{className:"configs__container",children:[(0,a.jsxs)("div",{className:"configs__header",children:[(0,a.jsx)("h1",{className:"configs__title",children:"Character Management"}),(0,a.jsx)(r.default,{variant:"secondary",onClick:K,children:"Logout"})]}),_&&(0,a.jsx)("p",{className:"configs__error",children:_}),R?(0,a.jsx)("p",{children:"Loading characters..."}):(0,a.jsx)(c,{characters:f,states:x,classes:b,races:N,occupations:w,associations:S,places:A,onAdd:z,onEdit:H,onDelete:W})]})}):(0,a.jsx)("div",{className:"configs",children:(0,a.jsxs)("div",{className:"configs__login",children:[(0,a.jsx)("h1",{className:"configs__title",children:"Admin Login"}),(0,a.jsxs)("form",{className:"configs__form",onSubmit:I,children:[(0,a.jsxs)("div",{className:"configs__field",children:[(0,a.jsx)("label",{htmlFor:"email",children:"Email"}),(0,a.jsx)("input",{id:"email",type:"email",value:o,onChange:e=>u(e.target.value),required:!0,autoComplete:"email"})]}),(0,a.jsxs)("div",{className:"configs__field",children:[(0,a.jsx)("label",{htmlFor:"password",children:"Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:h,onChange:e=>m(e.target.value),required:!0,autoComplete:"current-password"})]}),_&&(0,a.jsx)("p",{className:"configs__error",children:_}),(0,a.jsxs)("div",{className:"configs__actions",children:[(0,a.jsx)(r.default,{type:"submit",disabled:U,children:U?"Logging in...":"Login"}),(0,a.jsx)(r.default,{variant:"secondary",onClick:()=>e.push("/"),children:"Back to Home"})]})]})]})})}e.s(["default",()=>d],82929)}]);